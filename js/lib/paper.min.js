var paper=new function(){var o=new function(){function a(a,b,c){if(y)try{return delete a[b],y(a,b,c)}catch(d){}(c.get||c.set)&&a.__defineGetter__?(c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)):a[b]=c.value;return a}function b(a,b){if(w)try{return w(a,b)}catch(c){}var d=a.__lookupGetter__&&a.__lookupGetter__(b);return d?{get:d,set:a.__lookupSetter__(b),enumerable:!0,configurable:!0}:l.call(a,b)?{value:a[b],enumerable:!0,configurable:!0,writable:!0}:null}function c(c,d,e,g,
f,h){function m(h,i,s,j){var i=i||(i=b(d,h))&&(i.get?i:i.value),u="function"===typeof i,w=i,o=f||u?i&&i.get?h in c:c[h]:null;if(j&&u&&(!f||!j[h]))j[h]=function(a){return a&&c[h].apply(a,M.call(arguments,1))};if((s||void 0!==i&&l.call(d,h))&&(!f||!o)){if(u){if(o&&/\bthis\.base\b/.test(i)){var y=g&&g[h]==o,w=function(){var c=b(this,"base");a(this,"base",{value:y?g[h]:o,configurable:!0});try{return i.apply(this,arguments)}finally{c?a(this,"base",c):delete this.base}};w.toString=function(){return i.toString()};
w.valueOf=function(){return i.valueOf()}}n&&(0==i.length&&(p=h.match(/^(get|is)(([A-Z])(.*))$/)))&&n.push([p[3].toLowerCase()+p[4],p[2]])}if(!w||u||!w.get)w={value:w,writable:!0};if((b(c,h)||{configurable:!0}).configurable)w.configurable=!0,w.enumerable=e;a(c,h,w)}}var n,p;if(d){n=[];for(var s in d)l.call(d,s)&&!i.test(s)&&m(s,null,!0,h);m("toString");m("valueOf");h=0;for(s=n&&n.length;h<s;h++)try{p=n[h];var j=p[1];m(p[0],{get:c["get"+j]||c["is"+j],set:c["set"+j]},!0)}catch(u){}}return c}function d(b){var c=
function(d){h&&a(this,"__proto__",{value:b});if(this.initialize&&d!==c.dont)return this.initialize.apply(this,arguments)};c.prototype=b;c.toString=function(){return(this.prototype.initialize||function(){}).toString()};return c}function e(a){return!a?function(a){return a}:"function"!==typeof a?function(b){return b==a}:a}function f(a,b,c,d){try{a&&(d||void 0===d&&p(a)?s:j).call(a,e(b),c=c||a)}catch(g){if(g!==o.stop)throw g;}return c}function g(a){return f(a,function(a,b){this[b]=a},new a.constructor)}
var h=!this.__proto__,i=/^(statics|generics|preserve|enumerable|prototype|__proto__|toString|valueOf)$/,m=Object.prototype,l=h?function(a){return"__proto__"!==a&&this.hasOwnProperty(a)}:m.hasOwnProperty,n=m.toString,m=Array.prototype,p=Array.isArray=Array.isArray||function(a){return"[object Array]"===n.call(a)},M=m.slice,s=m.forEach||function(a,b){for(var c=0,d=this.length;c<d;c++)a.call(b,this[c],c,this)},j=function(a,b){for(var c in this)this.hasOwnProperty(c)&&a.call(b,this[c],c,this)},y=Object.defineProperty,
w=Object.getOwnPropertyDescriptor;return c(function(){},{inject:function(a){if(a){var b=this.prototype,d=b.__proto__&&b.__proto__.constructor,e=!0==a.statics?a:a.statics;e!=a&&c(b,a,a.enumerable,d&&d.prototype,a.preserve,a.generics&&this);c(this,e,!0,d,a.preserve)}b=1;for(d=arguments.length;b<d;b++)this.inject(arguments[b]);return this},extend:function(b){var e=new this(this.dont),g=d(e);a(e,"constructor",{value:g,writable:!0,configurable:!0});g.dont={};c(g,this,!0);return arguments.length?this.inject.apply(g,
arguments):g}},!0).inject({has:l,each:f,inject:function(){for(var a=0,b=arguments.length;a<b;a++)c(this,arguments[a]);return this},extend:function(){var a=new (d(this));return a.inject.apply(a,arguments)},each:function(a,b){return f(this,a,b)},clone:function(){return g(this)},statics:{each:f,clone:g,define:a,describe:b,iterator:e,has:function(a,b){return l.call(a,b)},type:function(a){return(a||0===a)&&(a._type||typeof a)||null},check:function(a){return!!(a||0===a)},pick:function(){for(var a=0,b=arguments.length;a<
b;a++)if(void 0!==arguments[a])return arguments[a];return null},stop:{}}})};this.Base=o.inject({generics:!0,clone:function(){return new this.constructor(this)},toString:function(){return"{ "+o.each(this,function(a,b){if("_"!=b.charAt(0)){var c=typeof a;this.push(b+": "+("number"===c?o.formatNumber(a):"string"===c?"'"+a+"'":a))}},[]).join(", ")+" }"},statics:{read:function(a,b,c){var b=b||0,c=c||a.length-b,d=a[b];if(d instanceof this||this.prototype._readNull&&null==d&&1>=c)return d;d=new this(this.dont);
return d.initialize.apply(d,0<b||c<a.length?Array.prototype.slice.call(a,b,b+c):a)||d},readAll:function(a,b){for(var c=[],d,e=b||0,f=a.length;e<f;e++)c.push(Array.isArray(d=a[e])?this.read(d,0):this.read(a,e,1));return c},splice:function(a,b,c,d){for(var e=b&&b.length,f=void 0===c,c=f?a.length:c,g=0;g<e;g++)b[g]._index=c+g;if(f)return a.push.apply(a,b),[];g=[c,d];b&&g.push.apply(g,b);b=a.splice.apply(a,g);g=0;for(d=b.length;g<d;g++)delete b[g]._index;g=c+e;for(d=a.length;g<d;g++)a[g]._index=g;return b},
merge:function(){return o.each(arguments,function(a){o.each(a,function(a,c){this[c]=a},this)},new o,!0)},capitalize:function(a){return a.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},camelize:function(a){return a.replace(/-(\w)/g,function(a,c){return c.toUpperCase()})},hyphenate:function(a){return a.replace(/[a-z][A-Z0-9]|[0-9][a-zA-Z]|[A-Z]{2}[a-z]/g,function(a){return a.charAt(0)+"-"+a.substring(1)}).toLowerCase()},formatNumber:function(a){return(Math.round(1E5*a)/1E5).toString()}}});
var X=this.PaperScope=o.extend({initialize:function(a){paper=this;this.project=null;this.projects=[];this.tools=[];this._id=a&&(a.getAttribute("id")||a.src)||"paperscope-"+X._id++;a&&a.setAttribute("id",this._id);X._scopes[this._id]=this},version:0.22,getView:function(){return this.project.view},getTool:function(){this._tool||(this._tool=new R);return this._tool},evaluate:function(a){a=Y.evaluate(a,this);C.updateFocus();return a},install:function(a){var b=this;o.each(["project","view","tool"],function(c){o.define(a,
c,{configurable:!0,writable:!0,get:function(){return b[c]}})});for(var c in this)!/^(version|_id|load)/.test(c)&&!(c in a)&&(a[c]=this[c])},setup:function(a){paper=this;this.project=new za(a)},clear:function(){for(var a=this.projects.length-1;0<=a;a--)this.projects[a].remove();for(a=this.tools.length-1;0<=a;a--)this.tools[a].remove()},remove:function(){this.clear();delete X._scopes[this._id]},statics:{_scopes:{},_id:0,get:function(a){"object"===typeof a&&(a=a.getAttribute("id"));return this._scopes[a]||
null}}}),ua=o.extend({initialize:function(a){this._scope=paper;this._index=this._scope[this._list].push(this)-1;(a||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;this._scope[this._reference]=this;return!0},remove:function(){if(null==this._index)return!1;o.splice(this._scope[this._list],null,this._index,1);this._scope[this._reference]==this&&(this._scope[this._reference]=null);this._scope=null;return!0}}),ia={attach:function(a,b){if("string"!==typeof a)return o.each(a,
function(a,b){this.attach(b,a)},this);var c=this._eventTypes[a];if(!c)return this;var d=this._handlers=this._handlers||{},d=d[a]=d[a]||[];-1==d.indexOf(b)&&(d.push(b),c.install&&1==d.length&&c.install.call(this,a));return this},detach:function(a,b){if("string"!==typeof a)return o.each(a,function(a,b){this.detach(b,a)},this);var c=this._eventTypes[a],d=this._handlers&&this._handlers[a],e;c&&d&&(!b||-1!=(e=d.indexOf(b))&&1==d.length?(c.uninstall&&c.uninstall.call(this,a),delete this._handlers[a]):-1!=
e&&d.splice(e,1));return this},fire:function(a,b){var c=this._handlers&&this._handlers[a];if(!c)return!1;o.each(c,function(a){!1===a.call(this,b)&&(b&&b.stop)&&b.stop()},this);return!0},responds:function(a){return!(!this._handlers||!this._handlers[a])},statics:{inject:function(){for(var a=0,b=arguments.length;a<b;a++){var c=arguments[a],d=c._events;if(d){var e={};o.each(d,function(a,b){var d="string"===typeof a,i=d?a:b,m=o.capitalize(i),l=i.substring(2).toLowerCase();e[l]=d?{}:a;i="_"+i;c["get"+m]=
function(){return this[i]};c["set"+m]=function(a){a?this.attach(l,a):this[i]&&this.detach(l,this[i]);this[i]=a}});c._eventTypes=e}this.base(c)}return this}}},j=this.Point=o.extend({initialize:function(a,b){void 0!==b?(this.x=a,this.y=b):void 0!==a?null==a?this.x=this.y=0:void 0!==a.x?(this.x=a.x,this.y=a.y):void 0!==a.width?(this.x=a.width,this.y=a.height):Array.isArray(a)?(this.x=a[0],this.y=1<a.length?a[1]:a[0]):void 0!==a.angle?(this.x=a.length,this.y=0,this.setAngle(a.angle)):this.x="number"===
typeof a?this.y=a:this.y=0:this.x=this.y=0},set:function(a,b){this.x=a;this.y=b;return this},clone:function(){return j.create(this.x,this.y)},toString:function(){var a=o.formatNumber;return"{ x: "+a(this.x)+", y: "+a(this.y)+" }"},add:function(a){a=j.read(arguments);return j.create(this.x+a.x,this.y+a.y)},subtract:function(a){a=j.read(arguments);return j.create(this.x-a.x,this.y-a.y)},multiply:function(a){a=j.read(arguments);return j.create(this.x*a.x,this.y*a.y)},divide:function(a){a=j.read(arguments);
return j.create(this.x/a.x,this.y/a.y)},modulo:function(a){a=j.read(arguments);return j.create(this.x%a.x,this.y%a.y)},negate:function(){return j.create(-this.x,-this.y)},transform:function(a){return a?a._transformPoint(this):this},getDistance:function(a,b){var a=j.read(arguments),c=a.x-this.x,d=a.y-this.y,c=c*c+d*d;return b?c:Math.sqrt(c)},getLength:function(a){var b=this.x*this.x+this.y*this.y;return a?b:Math.sqrt(b)},setLength:function(a){if(this.isZero()){var b=this._angle||0;this.set(Math.cos(b)*
a,Math.sin(b)*a)}else a/=this.getLength(),0==a&&this.getAngle(),this.set(this.x*a,this.y*a);return this},normalize:function(a){void 0===a&&(a=1);var b=this.getLength(),a=0!=b?a/b:0,a=j.create(this.x*a,this.y*a);a._angle=this._angle;return a},getAngle:function(a){return 180*this.getAngleInRadians(a)/Math.PI},setAngle:function(a){a=this._angle=a*Math.PI/180;if(!this.isZero()){var b=this.getLength();this.set(Math.cos(a)*b,Math.sin(a)*b)}return this},getAngleInRadians:function(){if(void 0===arguments[0])return null==
this._angle&&(this._angle=Math.atan2(this.y,this.x)),this._angle;var a=j.read(arguments),b=this.getLength()*a.getLength();return 0==b?NaN:Math.acos(this.dot(a)/b)},getAngleInDegrees:function(a){return this.getAngle(a)},getQuadrant:function(){return 0<=this.x?0<=this.y?1:4:0<=this.y?2:3},getDirectedAngle:function(a){a=j.read(arguments);return 180*Math.atan2(this.cross(a),this.dot(a))/Math.PI},rotate:function(a,b){var a=a*Math.PI/180,c=b?this.subtract(b):this,d=Math.sin(a),e=Math.cos(a),c=j.create(c.x*
e-c.y*d,c.y*e+c.x*d);return b?c.add(b):c},equals:function(a){a=j.read(arguments);return this.x==a.x&&this.y==a.y},isInside:function(a){return a.contains(this)},isClose:function(a,b){return this.getDistance(a)<b},isColinear:function(a){return this.cross(a)<E.TOLERANCE},isOrthogonal:function(a){return this.dot(a)<E.TOLERANCE},isZero:function(){return 0==this.x&&0==this.y},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(a){a=j.read(arguments);return this.x*a.x+this.y*a.y},cross:function(a){a=
j.read(arguments);return this.x*a.y-this.y*a.x},project:function(a){a=j.read(arguments);if(a.isZero())return j.create(0,0);var b=this.dot(a)/a.dot(a);return j.create(a.x*b,a.y*b)},statics:{create:function(a,b){var c=new j(j.dont);c.x=a;c.y=b;return c},min:function(a,b){a=j.read(arguments,0,1);b=j.read(arguments,1,1);return j.create(Math.min(a.x,b.x),Math.min(a.y,b.y))},max:function(a,b){a=j.read(arguments,0,1);b=j.read(arguments,1,1);return j.create(Math.max(a.x,b.x),Math.max(a.y,b.y))},random:function(){return j.create(Math.random(),
Math.random())}}},new function(){return o.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return j.create(b(this.x),b(this.y))}},{})}),S=j.extend({set:function(a,b,c){this._x=a;this._y=b;if(!c)this._owner[this._setter](this);return this},getX:function(){return this._x},setX:function(a){this._x=a;this._owner[this._setter](this)},getY:function(){return this._y},setY:function(a){this._y=a;this._owner[this._setter](this)},statics:{create:function(a,b,c,d,e){if(e)return j.create(c,
d);e=new S(S.dont);e._x=c;e._y=d;e._owner=a;e._setter=b;return e}}}),r=this.Size=o.extend({initialize:function(a,b){void 0!==b?(this.width=a,this.height=b):void 0!==a?null==a?this.width=this.height=0:void 0!==a.width?(this.width=a.width,this.height=a.height):void 0!==a.x?(this.width=a.x,this.height=a.y):Array.isArray(a)?(this.width=a[0],this.height=1<a.length?a[1]:a[0]):this.width="number"===typeof a?this.height=a:this.height=0:this.width=this.height=0},toString:function(){var a=o.formatNumber;return"{ width: "+
a(this.width)+", height: "+a(this.height)+" }"},set:function(a,b){this.width=a;this.height=b;return this},clone:function(){return r.create(this.width,this.height)},add:function(a){a=r.read(arguments);return r.create(this.width+a.width,this.height+a.height)},subtract:function(a){a=r.read(arguments);return r.create(this.width-a.width,this.height-a.height)},multiply:function(a){a=r.read(arguments);return r.create(this.width*a.width,this.height*a.height)},divide:function(a){a=r.read(arguments);return r.create(this.width/
a.width,this.height/a.height)},modulo:function(a){a=r.read(arguments);return r.create(this.width%a.width,this.height%a.height)},negate:function(){return r.create(-this.width,-this.height)},equals:function(a){a=r.read(arguments);return this.width==a.width&&this.height==a.height},isZero:function(){return 0==this.width&&0==this.height},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{create:function(a,b){return(new r(r.dont)).set(a,b)},min:function(a,b){return r.create(Math.min(a.width,
b.width),Math.min(a.height,b.height))},max:function(a,b){return r.create(Math.max(a.width,b.width),Math.max(a.height,b.height))},random:function(){return r.create(Math.random(),Math.random())}}},new function(){return o.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return r.create(b(this.width),b(this.height))}},{})}),ba=r.extend({set:function(a,b,c){this._width=a;this._height=b;if(!c)this._owner[this._setter](this);return this},getWidth:function(){return this._width},
setWidth:function(a){this._width=a;this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(a){this._height=a;this._owner[this._setter](this)},statics:{create:function(a,b,c,d,e){if(e)return r.create(c,d);e=new ba(ba.dont);e._width=c;e._height=d;e._owner=a;e._setter=b;return e}}}),t=this.Rectangle=o.extend({initialize:function(a,b,c,d){if(4==arguments.length)this.x=a,this.y=b,this.width=c,this.height=d;else if(2==arguments.length)if(b&&void 0!==b.x){var e=j.read(arguments,
0,1),f=j.read(arguments,1,1);this.x=e.x;this.y=e.y;this.width=f.x-e.x;this.height=f.y-e.y;0>this.width&&(this.x=f.x,this.width=-this.width);0>this.height&&(this.y=f.y,this.height=-this.height)}else e=j.read(arguments,0,1),f=r.read(arguments,1,1),this.x=e.x,this.y=e.y,this.width=f.width,this.height=f.height;else a?(this.x=a.x||0,this.y=a.y||0,this.width=a.width||0,this.height=a.height||0):this.x=this.y=this.width=this.height=0},set:function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d;return this},
getPoint:function(a){return S.create(this,"setPoint",this.x,this.y,a)},setPoint:function(a){a=j.read(arguments);this.x=a.x;this.y=a.y;return this},getSize:function(a){return ba.create(this,"setSize",this.width,this.height,a)},setSize:function(a){a=r.read(arguments);this.width=a.width;this.height=a.height;return this},getLeft:function(){return this.x},setLeft:function(a){this.width-=a-this.x;this.x=a;return this},getTop:function(){return this.y},setTop:function(a){this.height-=a-this.y;this.y=a;return this},
getRight:function(){return this.x+this.width},setRight:function(a){this.width=a-this.x;return this},getBottom:function(){return this.y+this.height},setBottom:function(a){this.height=a-this.y;return this},getCenterX:function(){return this.x+0.5*this.width},setCenterX:function(a){this.x=a-0.5*this.width;return this},getCenterY:function(){return this.y+0.5*this.height},setCenterY:function(a){this.y=a-0.5*this.height;return this},getCenter:function(a){return S.create(this,"setCenter",this.getCenterX(),
this.getCenterY(),a)},setCenter:function(a){a=j.read(arguments);return this.setCenterX(a.x).setCenterY(a.y)},equals:function(a){a=t.read(arguments);return this.x==a.x&&this.y==a.y&&this.width==a.width&&this.height==a.height},isEmpty:function(){return 0==this.width||0==this.height},toString:function(){var a=o.formatNumber;return"{ x: "+a(this.x)+", y: "+a(this.y)+", width: "+a(this.width)+", height: "+a(this.height)+" }"},contains:function(a){return a&&void 0!==a.width||4==(Array.isArray(a)?a:arguments).length?
this._containsRectangle(t.read(arguments)):this._containsPoint(j.read(arguments))},_containsPoint:function(a){var b=a.x,a=a.y;return b>=this.x&&a>=this.y&&b<=this.x+this.width&&a<=this.y+this.height},_containsRectangle:function(a){var b=a.x,c=a.y;return b>=this.x&&c>=this.y&&b+a.width<=this.x+this.width&&c+a.height<=this.y+this.height},intersects:function(a){a=t.read(arguments);return a.x+a.width>this.x&&a.y+a.height>this.y&&a.x<this.x+this.width&&a.y<this.y+this.height},intersect:function(a){var a=
t.read(arguments),b=Math.max(this.x,a.x),c=Math.max(this.y,a.y),d=Math.min(this.x+this.width,a.x+a.width),e=Math.min(this.y+this.height,a.y+a.height);return t.create(b,c,d-b,e-c)},unite:function(a){var a=t.read(arguments),b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x+a.width),e=Math.max(this.y+this.height,a.y+a.height);return t.create(b,c,d-b,e-c)},include:function(a){var a=j.read(arguments),b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,
a.x),e=Math.max(this.y+this.height,a.y);return t.create(b,c,d-b,e-c)},expand:function(a,b){void 0===b&&(b=a);return t.create(this.x-a/2,this.y-b/2,this.width+a,this.height+b)},scale:function(a,b){return this.expand(this.width*a-this.width,this.height*(void 0===b?a:b)-this.height)},statics:{create:function(a,b,c,d){return(new t(t.dont)).set(a,b,c,d)}}},new function(){return o.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],
["Bottom","Center"]],function(a,b){var c=a.join(""),d=/^[RL]/.test(c);4<=b&&(a[1]+=d?"Y":"X");var e=a[d?0:1],d=a[d?1:0],f="get"+e,g="get"+d,h="set"+e,i="set"+d,m="set"+c;this["get"+c]=function(a){return S.create(this,m,this[f](),this[g](),a)};this[m]=function(a){a=j.read(arguments);return this[h](a.x)[i](a.y)}},{})}),ja=t.extend({set:function(a,b,c,d,e){this._x=a;this._y=b;this._width=c;this._height=d;if(!e)this._owner[this._setter](this);return this},statics:{create:function(a,b,c,d,e,f){c=(new ja(ja.dont)).set(c,
d,e,f,!0);c._owner=a;c._setter=b;return c}}},new function(){var a=t.prototype;return o.each(["x","y","width","height"],function(a){var c=o.capitalize(a),d="_"+a;this["get"+c]=function(){return this[d]};this["set"+c]=function(a){this[d]=a;if(!this._dontNotify)this._owner[this._setter](this)}},o.each("Point Size Center Left Top Right Bottom CenterX CenterY TopLeft TopRight BottomLeft BottomRight LeftCenter TopCenter RightCenter BottomCenter".split(" "),function(b){var c="set"+b;this[c]=function(b){this._dontNotify=
true;a[c].apply(this,arguments);delete this._dontNotify;this._owner[this._setter](this);return this}},{}))}),I=this.Matrix=o.extend({initialize:function(a){var b=arguments.length,c=!0;6==b?this.set.apply(this,arguments):1==b?a instanceof I?this.set(a._a,a._c,a._b,a._d,a._tx,a._ty):Array.isArray(a)?this.set.apply(this,a):c=!1:0==b?this.setIdentity():c=!1;if(!c)throw Error("Unsupported matrix parameters");},clone:function(){return I.create(this._a,this._c,this._b,this._d,this._tx,this._ty)},set:function(a,
b,c,d,e,f){this._a=a;this._c=b;this._b=c;this._d=d;this._tx=e;this._ty=f;return this},setIdentity:function(){this._a=this._d=1;this._c=this._b=this._tx=this._ty=0;return this},scale:function(a,b,c){2>arguments.length||"object"===typeof b?(c=j.read(arguments,1),b=a):c=j.read(arguments,2);c&&this.translate(c);this._a*=a;this._c*=a;this._b*=b;this._d*=b;c&&this.translate(c.negate());return this},translate:function(a){var a=j.read(arguments),b=a.x,c=a.y;this._tx+=b*this._a+c*this._b;this._ty+=b*this._c+
c*this._d;return this},rotate:function(a,b){return this.concatenate(I.getRotateInstance.apply(I,arguments))},shear:function(a,b,c){2>arguments.length||"object"===typeof b?(c=j.read(arguments,1),b=a):c=j.read(arguments,2);c&&this.translate(c);var d=this._a,e=this._c;this._a+=b*this._b;this._c+=b*this._d;this._b+=a*d;this._d+=a*e;c&&this.translate(c.negate());return this},toString:function(){var a=o.formatNumber;return"[["+[a(this._a),a(this._b),a(this._tx)].join(", ")+"], ["+[a(this._c),a(this._d),
a(this._ty)].join(", ")+"]]"},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},concatenate:function(a){var b=this._a,c=this._b,d=this._c,e=this._d;this._a=a._a*b+a._c*c;this._b=a._b*b+a._d*c;this._c=a._a*d+a._c*e;this._d=a._b*d+a._d*e;this._tx+=a._tx*b+a._ty*c;this._ty+=a._tx*d+a._ty*e;return this},preConcatenate:function(a){var b=this._a,c=this._b,d=this._c,e=this._d,f=this._tx,g=this._ty;this._a=a._a*b+a._b*d;this._b=a._a*c+a._b*e;this._c=a._c*b+a._d*d;this._d=a._c*
c+a._d*e;this._tx=a._a*f+a._b*g+a._tx;this._ty=a._c*f+a._d*g+a._ty;return this},transform:function(a,b,c,d,e){return 5>arguments.length?this._transformPoint(j.read(arguments)):this._transformCoordinates(a,b,c,d,e)},_transformPoint:function(a,b,c){var d=a.x,a=a.y;b||(b=new j(j.dont));return b.set(d*this._a+a*this._b+this._tx,d*this._c+a*this._d+this._ty,c)},_transformCoordinates:function(a,b,c,d,e){for(var f=b,b=b+2*e;f<b;){var e=a[f++],g=a[f++];c[d++]=e*this._a+g*this._b+this._tx;c[d++]=e*this._c+
g*this._d+this._ty}return c},_transformCorners:function(a){var b=a.x,c=a.y,d=b+a.width,a=c+a.height,b=[b,c,d,c,d,a,b,a];return this._transformCoordinates(b,0,b,0,4)},_transformBounds:function(a,b,c){for(var a=this._transformCorners(a),d=a.slice(0,2),e=a.slice(0),f=2;8>f;f++){var g=a[f],h=f&1;g<d[h]?d[h]=g:g>e[h]&&(e[h]=g)}b||(b=new t(t.dont));return b.set(d[0],d[1],e[0]-d[0],e[1]-d[1],c)},inverseTransform:function(a){return this._inverseTransform(j.read(arguments))},_getDeterminant:function(){var a=
this._a*this._d-this._b*this._c;return isFinite(a)&&Math.abs(a)>E.EPSILON&&isFinite(this._tx)&&isFinite(this._ty)?a:null},_inverseTransform:function(a,b,c){var d=this._getDeterminant();if(!d)return null;var e=a.x-this._tx,a=a.y-this._ty;b||(b=new j(j.dont));return b.set((e*this._d-a*this._b)/d,(a*this._a-e*this._c)/d,c)},getTranslation:function(){return j.create(this._tx,this._ty)},getScaling:function(){var a=Math.sqrt(this._a*this._a+this._c*this._c),b=Math.sqrt(this._b*this._b+this._d*this._d);
return j.create(0>this._a?-a:a,0>this._b?-b:b)},getRotation:function(){var a=-Math.atan2(this._b,this._d),b=Math.atan2(this._c,this._a);return Math.abs(a-b)<E.TOLERANCE?180*a/Math.PI:void 0},equals:function(a){return this._a==a._a&&this._b==a._b&&this._c==a._c&&this._d==a._d&&this._tx==a._tx&&this._ty==a._ty},isIdentity:function(){return 1==this._a&&0==this._c&&0==this._b&&1==this._d&&0==this._tx&&0==this._ty},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},
createInverse:function(){var a=this._getDeterminant();return a&&I.create(this._d/a,-this._c/a,-this._b/a,this._a/a,(this._b*this._ty-this._d*this._tx)/a,(this._c*this._tx-this._a*this._ty)/a)},createShiftless:function(){return I.create(this._a,this._c,this._b,this._d,0,0)},setToScale:function(a,b){return this.set(a,0,0,b,0,0)},setToTranslation:function(a){a=j.read(arguments);return this.set(1,0,0,1,a.x,a.y)},setToShear:function(a,b){return this.set(1,b,a,1,0,0)},setToRotation:function(a,b){var b=
j.read(arguments,1),a=a*Math.PI/180,c=b.x,d=b.y,e=Math.cos(a),f=Math.sin(a);return this.set(e,f,-f,e,c-c*e+d*f,d-c*f-d*e)},applyToContext:function(a,b){a[b?"setTransform":"transform"](this._a,this._c,this._b,this._d,this._tx,this._ty);return this},statics:{create:function(a,b,c,d,e,f){return(new I(I.dont)).set(a,b,c,d,e,f)},getScaleInstance:function(a,b){var c=new I;return c.setToScale.apply(c,arguments)},getTranslateInstance:function(a){var b=new I;return b.setToTranslation.apply(b,arguments)},getShearInstance:function(a,
b,c){var d=new I;return d.setToShear.apply(d,arguments)},getRotateInstance:function(a,b){var c=new I;return c.setToRotation.apply(c,arguments)}}},new function(){return o.each({scaleX:"_a",scaleY:"_d",translateX:"_tx",translateY:"_ty",shearX:"_b",shearY:"_c"},function(a,b){b=o.capitalize(b);this["get"+b]=function(){return this[a]};this["set"+b]=function(b){this[a]=b}},{})}),V=this.Line=o.extend({initialize:function(a,b,c){a=j.read(arguments,0,1);b=j.read(arguments,1,1);3==arguments.length?(this.point=
a,this.vector=b.subtract(a),this.infinite=c):(this.point=a,this.vector=b,this.infinite=!0)},intersect:function(a){var b=this.vector.cross(a.vector);if(Math.abs(b)<=E.EPSILON)return null;var c=a.point.subtract(this.point),d=c.cross(a.vector)/b,b=c.cross(this.vector)/b;return(this.infinite||0<=d&&1>=d)&&(a.infinite||0<=b&&1>=b)?this.point.add(this.vector.multiply(d)):null},getSide:function(a){var b=this.vector,a=a.subtract(this.point),c=a.cross(b);0==c&&(c=a.dot(b),0<c&&(c=a.subtract(b).dot(b),0>c&&
(c=0)));return 0>c?-1:0<c?1:0},getDistance:function(a){var b=this.vector.y/this.vector.x,b=Math.abs(a.y-b*a.x-(this.point.y-b*this.point.x))/Math.sqrt(b*b+1);return this.infinite?b:Math.min(b,a.getDistance(this.point),a.getDistance(this.point.add(this.vector)))}}),za=this.Project=ua.extend({_list:"projects",_reference:"project",initialize:function(a){this.base(!0);this._currentStyle=new fa;this._selectedItems={};this._selectedItemCount=0;this.layers=[];this.symbols=[];this.activeLayer=new ca;a&&(this.view=
a instanceof C?a:C.create(a))},_needsRedraw:function(){this.view&&(this.view._redrawNeeded=!0)},remove:function(){if(!this.base())return!1;this.view&&this.view.remove();return!0},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(a){this._currentStyle.initialize(a)},getIndex:function(){return this._index},getSelectedItems:function(){var a=[];o.each(this._selectedItems,function(b){a.push(b)});return a},_updateSelection:function(a){a._selected?(this._selectedItemCount++,
this._selectedItems[a._id]=a):(this._selectedItemCount--,delete this._selectedItems[a._id])},selectAll:function(){for(var a=0,b=this.layers.length;a<b;a++)this.layers[a].setSelected(!0)},deselectAll:function(){for(var a in this._selectedItems)this._selectedItems[a].setSelected(!1)},hitTest:function(a,b){for(var b=HitResult.getOptions(a,b),a=b.point,c=this.layers.length-1;0<=c;c--){var d=this.layers[c].hitTest(a,b);if(d)return d}return null},draw:function(a,b){a.save();b.isIdentity()||b.applyToContext(a);
for(var c={offset:new j(0,0)},d=0,e=this.layers.length;d<e;d++)D.draw(this.layers[d],a,c);a.restore();if(0<this._selectedItemCount){a.save();a.strokeWidth=1;a.strokeStyle=a.fillStyle="#009dec";var f={},g=function(a,b,c){var d=c&&f[a._id];if(d)return b.concatenate(d),b;a._parent?(g(a._parent,b,!0),a._matrix.isIdentity()||b.concatenate(a._matrix)):b.initialize(a._matrix);c&&(f[a._id]=b.clone());return b},h;for(h in this._selectedItems)c=this._selectedItems[h],c.drawSelected(a,g(c,b.clone()));a.restore()}}}),
ka=this.Symbol=o.extend({initialize:function(a){this.project=paper.project;this.project.symbols.push(this);this.setDefinition(a);this._instances={}},_changed:function(a){o.each(this._instances,function(b){b._changed(a)})},getDefinition:function(){return this._definition},setDefinition:function(a){a._parentSymbol&&(a=a.clone());this._definition&&delete this._definition._parentSymbol;this._definition=a;a.remove();a.setPosition(new j);a._parentSymbol=this;this._changed(v.GEOMETRY)},place:function(a){return new va(this,
a)},clone:function(){return new ka(this._definition.clone())}}),v={HIERARCHY:3,GEOMETRY:5,STROKE:25,STYLE:17,ATTRIBUTE:33,CONTENT:65,PIXELS:129},D=this.Item=o.extend(ia,{_events:new function(){function a(a){for(var b=0,c=d.length;b<c;b++)d[b].fire("frame",a)}var b={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}},c={install:function(a){var c=this._project.view._eventCounters;
if(c)for(var d in b)c[d]=(c[d]||0)+(b[d][a]||0)},uninstall:function(a){var c=this._project.view._eventCounters;if(c)for(var d in b)c[d]-=b[d][a]||0}},d=[];return o.each("onMouseDown onMouseUp onMouseDrag onClick onDoubleClick onMouseMove onMouseEnter onMouseLeave".split(" "),function(a){this[a]=c},{onFrame:{install:function(){d.length||this._project.view.attach("frame",a);d.push(this)},uninstall:function(){d.splice(d.indexOf(this),1);d.length||this._project.view.detach("frame",a)}}})},initialize:function(a){this._id=
++D._id;this._project||paper.project.activeLayer.addChild(this);this._style||(this._style=fa.create(this));this.setStyle(this._project.getCurrentStyle());this._matrix=void 0!==a?a instanceof I?a.clone():(new I).translate(j.read(arguments,0)):new I},_changed:function(a){a&4&&(delete this._bounds,delete this._position);this._parent&&a&12&&this._parent._clearBoundsCache();a&2&&this._clearBoundsCache();a&1&&this._project._needsRedraw();this._parentSymbol&&this._parentSymbol._changed(a);if(this._project._changes){var b=
this._project._changesById[this._id];b?b.flags|=a:(b={item:this,flags:a},this._project._changesById[this._id]=b,this._project._changes.push(b))}},getId:function(){return this._id},getName:function(){return this._name},setName:function(a){this._name&&this._removeFromNamed();this._name=a||void 0;if(a&&this._parent){var b=this._parent._children,c=this._parent._namedChildren;(c[a]=c[a]||[]).push(this);b[a]=this}this._changed(32)},statics:{_id:0}},o.each(["locked","visible","blendMode","opacity","guide"],
function(a){var b=o.capitalize(a),a="_"+a;this["get"+b]=function(){return this[a]};this["set"+b]=function(b){b!=this[a]&&(this[a]=b,this._changed("_locked"===a?32:v.ATTRIBUTE))}},{}),{_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,isSelected:function(){if(this._children)for(var a=0,b=this._children.length;a<b;a++)if(this._children[a].isSelected())return!0;return this._selected},setSelected:function(a,b){if(this._children&&!b)for(var c=0,d=this._children.length;c<d;c++)this._children[c].setSelected(a);
else if((a=!!a)!=this._selected)this._selected=a,this._project._updateSelection(this),this._changed(v.ATTRIBUTE)},_selected:!1,isFullySelected:function(){if(this._children&&this._selected){for(var a=0,b=this._children.length;a<b;a++)if(!this._children[a].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(a){if(this._children)for(var b=0,c=this._children.length;b<c;b++)this._children[b].setFullySelected(a);this.setSelected(a,!0)},isClipMask:function(){return this._clipMask},
setClipMask:function(a){if(this._clipMask!=(a=!!a)){if(this._clipMask=a)this.setFillColor(null),this.setStrokeColor(null);this._changed(v.ATTRIBUTE);this._parent&&this._parent._changed(256)}},_clipMask:!1,getPosition:function(a){var b=this._position||(this._position=this.getBounds().getCenter(!0));return a?b:S.create(this,"setPosition",b.x,b.y)},setPosition:function(a){this.translate(j.read(arguments).subtract(this.getPosition(!0)))},getMatrix:function(){return this._matrix},setMatrix:function(a){this._matrix.initialize(a);
this._changed(v.GEOMETRY)}},o.each(["bounds","strokeBounds","handleBounds","roughBounds"],function(a){this["get"+o.capitalize(a)]=function(b){var c=this._boundsType,b=this._getCachedBounds("string"==typeof c?c:c&&c[a]||a,b);return"bounds"==a?ja.create(this,"setBounds",b.x,b.y,b.width,b.height):b}},{_getCachedBounds:function(a,b,c){var d=(!b||b.equals(this._matrix))&&a;if(c&&this._parent){var e=c._id,f=this._parent._boundsCache=this._parent._boundsCache||{ids:{},list:[]};f.ids[e]||(f.list.push(c),
f.ids[e]=c)}if(d&&this._bounds&&this._bounds[d])return this._bounds[d];e=this._matrix.isIdentity();b=!b||b.isIdentity()?e?null:this._matrix:e?b:b.clone().concatenate(this._matrix);a=this._getBounds(a,b,d?this:c);d&&(this._bounds||(this._bounds={}),this._bounds[d]=a.clone());return a},_clearBoundsCache:function(){if(this._boundsCache){for(var a=0,b=this._boundsCache.list,c=b.length;a<c;a++){var d=b[a];delete d._bounds;d!=this&&d._boundsCache&&d._clearBoundsCache()}delete this._boundsCache}},_getBounds:function(a,
b,c){var d=this._children;if(!d||0==d.length)return new t;for(var e=Infinity,f=-e,g=e,h=f,i=0,m=d.length;i<m;i++){var l=d[i];l._visible&&(l=l._getCachedBounds(a,b,c),e=Math.min(l.x,e),g=Math.min(l.y,g),f=Math.max(l.x+l.width,f),h=Math.max(l.y+l.height,h))}return t.create(e,g,f-e,h-g)},setBounds:function(a){var a=t.read(arguments),b=this.getBounds(),c=new I,d=a.getCenter();c.translate(d);if(a.width!=b.width||a.height!=b.height)c.scale(0!=b.width?a.width/b.width:1,0!=b.height?a.height/b.height:1);d=
b.getCenter();c.translate(-d.x,-d.y);this.transform(c)}}),{getProject:function(){return this._project},_setProject:function(a){if(this._project!=a&&(this._project=a,this._children))for(var b=0,c=this._children.length;b<c;b++)this._children[b]._setProject(a)},getLayer:function(){for(var a=this;a=a._parent;)if(a instanceof ca)return a;return null},getParent:function(){return this._parent},getChildren:function(){return this._children},setChildren:function(a){this.removeChildren();this.addChildren(a)},
getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},clone:function(){return this._clone(new this.constructor)},_clone:function(a){a.setStyle(this._style);if(this._children)for(var b=
0,c=this._children.length;b<c;b++)a.addChild(this._children[b].clone());for(var d="_locked _visible _blendMode _opacity _clipMask _guide".split(" "),b=0,c=d.length;b<c;b++){var e=d[b];this.hasOwnProperty(e)&&(a[e]=this[e])}a._matrix.initialize(this._matrix);a.setSelected(this._selected);this._name&&a.setName(this._name);return a},copyTo:function(a){var b=this.clone();a.layers?a.activeLayer.addChild(b):a.addChild(b);return b},rasterize:function(a){var b=this.getStrokeBounds(),a=(a||72)/72,c=L.getCanvas(b.getSize().multiply(a)),
d=c.getContext("2d");(new I).scale(a).translate(-b.x,-b.y).applyToContext(d);this.draw(d,{});a=new ga(c);a.setBounds(b);return a},hitTest:function(a,b){b=HitResult.getOptions(a,b);a=b.point=this._matrix._inverseTransform(b.point);if(!this._children&&!this.getRoughBounds().expand(b.tolerance)._containsPoint(a))return null;if((b.center||b.bounds)&&(!(this instanceof ca)||this._parent)){var c=this.getBounds(),d=this,e="TopLeft TopRight BottomLeft BottomRight LeftCenter TopCenter RightCenter BottomCenter".split(" "),
f,g=function(e,g){var f=c["get"+g]();if(a.getDistance(f)<b.tolerance)return new HitResult(e,d,{name:o.hyphenate(g),point:f})};if(b.center&&(f=g("center","Center")))return f;if(b.bounds)for(var h=0;8>h;h++)if(f=g("bounds",e[h]))return f}return this._children||!(b.guides&&!this._guide||b.selected&&!this._selected)?this._hitTest(a,b):null},_hitTest:function(a,b){if(this._children)for(var c=this._children.length-1;0<=c;c--){var d=this._children[c].hitTest(a,b);if(d)return d}},addChild:function(a){return this.insertChild(void 0,
a)},insertChild:function(a,b){return this._children?(b._remove(!1,!0),o.splice(this._children,[b],a,0),b._parent=this,b._setProject(this._project),b._name&&b.setName(b._name),this._changed(v.HIERARCHY),!0):!1},addChildren:function(a){for(var b=0,c=a&&a.length;b<c;b++)this.insertChild(void 0,a[b])},insertChildren:function(a,b){for(var c=0,d=b&&b.length;c<d;c++)this.insertChild(a,b[c])&&a++},insertAbove:function(a){var b=a._index;a._parent==this._parent&&b<this._index&&b++;return a._parent.insertChild(b,
this)},insertBelow:function(a){var b=a._index;a._parent==this._parent&&b>this._index&&b--;return a._parent.insertChild(b,this)},appendTop:function(a){return this.addChild(a)},appendBottom:function(a){return this.insertChild(0,a)},moveAbove:function(a){return this.insertAbove(a)},moveBelow:function(a){return this.insertBelow(a)},_removeFromNamed:function(){var a=this._parent._children,b=this._parent._namedChildren,c=this._name,d=b[c],e=d?d.indexOf(this):-1;-1!=e&&(a[c]==this&&delete a[c],d.splice(e,
1),d.length?a[c]=d[d.length-1]:delete b[c])},_remove:function(a,b){return this._parent?(a&&this.setSelected(!1),this._name&&this._removeFromNamed(),null!=this._index&&o.splice(this._parent._children,null,this._index,1),b&&this._parent._changed(v.HIERARCHY),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},removeChildren:function(a,b){if(!this._children)return null;for(var a=a||0,b=o.pick(b,this._children.length),c=o.splice(this._children,null,a,b-a),d=c.length-1;0<=d;d--)c[d]._remove(!0,
!1);0<c.length&&this._changed(v.HIERARCHY);return c},reverseChildren:function(){if(this._children){this._children.reverse();for(var a=0,b=this._children.length;a<b;a++)this._children[a]._index=a;this._changed(v.HIERARCHY)}},isEditable:function(){for(var a=this;a;){if(!a._visible||a._locked)return!1;a=a._parent}return!0},_getOrder:function(a){function b(a){var b=[];do b.unshift(a);while(a=a._parent);return b}for(var c=b(this),a=b(a),d=0,e=Math.min(c.length,a.length);d<e;d++)if(c[d]!=a[d])return c[d]._index<
a[d]._index?1:-1;return 0},hasChildren:function(){return this._children&&0<this._children.length},isAbove:function(a){return-1==this._getOrder(a)},isBelow:function(a){return 1==this._getOrder(a)},isParent:function(a){return this._parent==a},isChild:function(a){return a&&a._parent==this},isDescendant:function(a){for(var b=this;b=b._parent;)if(b==a)return!0;return!1},isAncestor:function(a){return a?a.isDescendant(this):!1},isGroupedWith:function(a){for(var b=this._parent;b;){if(b._parent&&(b instanceof
la||b instanceof wa)&&a.isDescendant(b))return!0;b=b._parent}return!1},scale:function(a,b,c,d){if(2>arguments.length||"object"===typeof b)d=c,c=b,b=a;return this.transform((new I).scale(a,b,c||this.getPosition(!0)),d)},translate:function(a,b){var c=new I;return this.transform(c.translate.apply(c,arguments),b)},rotate:function(a,b,c){return this.transform((new I).rotate(a,b||this.getPosition(!0)),c)},shear:function(a,b,c,d){if(2>arguments.length||"object"===typeof b)d=c,c=b,b=a;return this.transform((new I).shear(a,
b,c||this.getPosition(!0)),d)},transform:function(a,b){var c=this._bounds,d=this._position;this._matrix.preConcatenate(a);this._transform&&this._transform(a);b&&this.apply();this._changed(v.GEOMETRY);if(c&&0===a.getRotation()%90){for(var e in c)d=c[e],a._transformBounds(d,d);e=this._boundsType;if(d=c[e&&e.bounds||"bounds"])this._position=d.getCenter(!0);this._bounds=c}else d&&(this._position=a._transformPoint(d,d));return this},apply:function(){this._apply(this._matrix)&&this._matrix.setIdentity()},
_apply:function(a){if(this._children){for(var b=0,c=this._children.length;b<c;b++){var d=this._children[b];d.transform(a);d.apply()}return!0}},fitBounds:function(a,b){var a=t.read(arguments),c=this.getBounds(),d=c.height/c.width,e=a.height/a.width,d=(b?d>e:d<e)?a.width/c.width:a.height/c.height,c=new t(new j,r.create(c.width*d,c.height*d));c.setCenter(a.getCenter());this.setBounds(c)},toString:function(){return(this.constructor._name||"Item")+(this._name?" '"+this._name+"'":" @"+this._id)},_setStyles:function(a){var b=
this._style,c=b._strokeWidth,d=b._strokeJoin,e=b._strokeCap,f=b._miterLimit,g=b._fillColor,b=b._strokeColor;null!=c&&(a.lineWidth=c);d&&(a.lineJoin=d);e&&(a.lineCap=e);f&&(a.miterLimit=f);g&&(a.fillStyle=g.getCanvasStyle(a));b&&(a.strokeStyle=b.getCanvasStyle(a));if(!g||!b)a.globalAlpha=this._opacity},statics:{drawSelectedBounds:function(a,b,c){a=c._transformCorners(a);b.beginPath();for(c=0;8>c;c++)b[0==c?"moveTo":"lineTo"](a[c],a[++c]);b.closePath();b.stroke();for(c=0;8>c;c++)b.beginPath(),b.rect(a[c]-
2,a[++c]-2,4,4),b.fill()},draw:function(a,b,c){if(a._visible&&0!=a._opacity){var d,e,f,g;if("normal"!==a._blendMode||1>a._opacity&&(!a._segments||a.getFillColor()&&a.getStrokeColor())){d=a.getStrokeBounds();if(!d.width||!d.height)return;g=c.offset;e=b;f=c.offset=d.getTopLeft().floor();d=L.getCanvas(d.getSize().ceil().add(r.create(1,1)));b=d.getContext("2d")}c.clipping||b.save();d&&b.translate(-f.x,-f.y);a._matrix.applyToContext(b);a.draw(b,c);c.clipping||b.restore();d&&(c.offset=g,"normal"!==a._blendMode?
Aa.process(a._blendMode,b,e,a._opacity,f.subtract(g)):(e.save(),e.globalAlpha=a._opacity,e.drawImage(d,f.x,f.y),e.restore()),L.returnCanvas(d))}}}},o.each(["down","drag","up","move"],function(a){this["removeOn"+o.capitalize(a)]=function(){var b={};b[a]=!0;return this.removeOn(b)}},{removeOn:function(a){for(var b in a)if(a[b]){var c="mouse"+b,d=R._removeSets=R._removeSets||{};d[c]=d[c]||{};d[c][this._id]=this}return this}})),la=this.Group=D.extend({initialize:function(a){this.base();this._children=
[];this._namedChildren={};this.addChildren(!a||!Array.isArray(a)||"object"!==typeof a[0]?arguments:a)},_changed:function(a){D.prototype._changed.call(this,a);a&258&&delete this._clipItem},_getClipItem:function(){if(void 0!==this._clipItem)return this._clipItem;for(var a=0,b=this._children.length;a<b;a++){var c=this._children[a];if(c._clipMask)return this._clipItem=c}return this._clipItem=null},isClipped:function(){return!!this._getClipItem()},setClipped:function(a){var b=this.getFirstChild();b&&b.setClipMask(a);
return this},draw:function(a,b){var c=this._getClipItem();c&&(b.clipping=!0,D.draw(c,a,b),delete b.clipping);for(var d=0,e=this._children.length;d<e;d++){var f=this._children[d];f!=c&&D.draw(f,a,b)}}}),ca=this.Layer=la.extend({initialize:function(a){this._project=paper.project;this._index=this._project.layers.push(this)-1;this.base.apply(this,arguments);this.activate()},_remove:function(a,b){return this._parent?this.base(a,b):null!=this._index?(a&&this.setSelected(!1),o.splice(this._project.layers,
null,this._index,1),this._project._needsRedraw(),!0):!1},getNextSibling:function(){return this._parent?this.base():this._project.layers[this._index+1]||null},getPreviousSibling:function(){return this._parent?this.base():this._project.layers[this._index-1]||null},activate:function(){this._project.activeLayer=this}},new function(){function a(a){return function(c){return c instanceof ca&&!c._parent&&this._remove(!1,!0)?(o.splice(c._project.layers,[this],c._index+(a?1:-1),0),this._setProject(c._project),
!0):this.base(c)}}return{insertAbove:a(!0),insertBelow:a(!1)}}),Q=this.PlacedItem=D.extend({_boundsType:{bounds:"strokeBounds"}}),ga=this.Raster=Q.extend({_boundsType:"bounds",initialize:function(a,b){this.base(b);a.getContext?this.setCanvas(a):("string"===typeof a&&(a=document.getElementById(a)),this.setImage(a))},clone:function(){var a=this._image;a||(a=L.getCanvas(this._size),a.getContext("2d").drawImage(this._canvas,0,0));a=new ga(a);return this._clone(a)},getSize:function(){return this._size},
setSize:function(){var a=r.read(arguments),b=this.getImage();this.setCanvas(L.getCanvas(a));this.getContext(!0).drawImage(b,0,0,a.width,a.height)},getWidth:function(){return this._size.width},getHeight:function(){return this._size.height},getPpi:function(){var a=this._matrix,b=(new j(0,0)).transform(a),c=(new j(1,0)).transform(a).subtract(b),a=(new j(0,1)).transform(a).subtract(b);return r.create(72/c.getLength(),72/a.getLength())},getContext:function(a){this._context||(this._context=this.getCanvas().getContext("2d"));
a&&this._changed(v.PIXELS);return this._context},setContext:function(a){this._context=a},getCanvas:function(){this._canvas||(this._canvas=L.getCanvas(this._size),this._image&&this.getContext(!0).drawImage(this._image,0,0));return this._canvas},setCanvas:function(a){this._canvas&&L.returnCanvas(this._canvas);this._canvas=a;this._size=r.create(a.width,a.height);this._context=this._image=null;this._changed(v.GEOMETRY|v.PIXELS)},getImage:function(){return this._image||this.getCanvas()},setImage:function(a){this._canvas&&
L.returnCanvas(this._canvas);this._image=a;this._size=r.create(a.naturalWidth,a.naturalHeight);this._context=this._canvas=null;this._changed(v.GEOMETRY)},getSubImage:function(a){var a=t.read(arguments),b=L.getCanvas(a.getSize());b.getContext("2d").drawImage(this.getCanvas(),a.x,a.y,b.width,b.height,0,0,b.width,b.height);return b},drawImage:function(a,b){b=j.read(arguments,1);this.getContext(!0).drawImage(a,b.x,b.y)},getAverageColor:function(a){var b,c;a?a instanceof ma?(c=a,b=a.getBounds()):a.width?
b=new t(a):a.x&&(b=t.create(a.x-0.5,a.y-0.5,1,1)):b=this.getBounds();var a=Math.min(b.width,32),d=Math.min(b.height,32),e=ga._sampleContext;e?e.clearRect(0,0,32,32):e=ga._sampleContext=L.getCanvas(new r(32)).getContext("2d");e.save();e.scale(a/b.width,d/b.height);e.translate(-b.x,-b.y);c&&c.draw(e,{clip:!0});this._matrix.applyToContext(e);e.drawImage(this._canvas||this._image,-this._size.width/2,-this._size.height/2);e.restore();b=e.getImageData(0.5,0.5,Math.ceil(a),Math.ceil(d)).data;c=[0,0,0];d=
a=0;for(e=b.length;d<e;d+=4){var f=b[d+3],a=a+f,f=f/255;c[0]+=b[d]*f;c[1]+=b[d+1]*f;c[2]+=b[d+2]*f}for(d=0;3>d;d++)c[d]/=a;return a?T.read(c):null},getPixel:function(a){for(var a=j.read(arguments),b=this.getContext().getImageData(a.x,a.y,1,1).data,c=Array(4),d=0;4>d;d++)c[d]=b[d]/255;return W.read(c)},setPixel:function(a,b){var c=2==arguments.length,a=j.read(arguments,0,c?1:2),b=T.read(arguments,c?1:2),c=this.getContext(!0),d=c.createImageData(1,1),e=b.getAlpha();d.data[0]=255*b.getRed();d.data[1]=
255*b.getGreen();d.data[2]=255*b.getBlue();d.data[3]=null!=e?255*e:255;c.putImageData(d,a.x,a.y)},createData:function(a){a=r.read(arguments);return this.getContext().createImageData(a.width,a.height)},getData:function(a){a=t.read(arguments);a.isEmpty()&&(a=new t(this.getSize()));return this.getContext().getImageData(a.x,a.y,a.width,a.height)},setData:function(a,b){b=j.read(arguments,1);this.getContext(!0).putImageData(a,b.x,b.y)},_getBounds:function(a,b){var c=(new t(this._size)).setCenter(0,0);return b?
b._transformBounds(c):c},_hitTest:function(a){if(a.isInside(this._getBounds())){var b=this;return new HitResult("pixel",b,{offset:a.add(b._size.divide(2)).round(),getColor:function(){return b.getPixel(this.offset)}})}},draw:function(a){a.drawImage(this._canvas||this._image,-this._size.width/2,-this._size.height/2)},drawSelected:function(a,b){D.drawSelectedBounds((new t(this._size)).setCenter(0,0),a,b)}}),va=this.PlacedSymbol=Q.extend({initialize:function(a,b){this.base(b);this.setSymbol(a instanceof
ka?a:new ka(a))},getSymbol:function(){return this._symbol},setSymbol:function(a){this._symbol&&delete this._symbol._instances[this._id];this._symbol=a;a._instances[this._id]=this},clone:function(){return this._clone(new va(this.symbol,this._matrix.clone()))},_getBounds:function(a,b){return this.symbol._definition._getCachedBounds(a,b)},draw:function(a,b){D.draw(this.symbol._definition,a,b)},drawSelected:function(a,b){D.drawSelectedBounds(this.symbol._definition.getBounds(),a,b)}});HitResult=o.extend({initialize:function(a,
b,c){this.type=a;this.item=b;c&&this.inject(c)},statics:{getOptions:function(a,b){return b&&b._merged?b:o.merge({point:j.read(arguments,0,1),type:null,tolerance:2,fill:!b,stroke:!b,segments:!b,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1,_merged:!0},b)}}});var q=this.Segment=o.extend({initialize:function(a,b,c,d,e,f){var g=arguments.length,h=na.create,i,m,l;0!=g&&(1==g?a.point?(i=a.point,m=a.handleIn,l=a.handleOut):i=a:6>g?2==g&&void 0===b.x?i=[a,b]:(i=a,m=b,l=c):6==g&&(i=[a,b],m=
[c,d],l=[e,f]));h(this,"_point",i);h(this,"_handleIn",m);h(this,"_handleOut",l)},_changed:function(a){if(this._path){var b=this._path._curves&&this.getCurve(),c;b&&(b._changed(),(c=b[a==this._point||a==this._handleIn&&b._segment1==this?"getPrevious":"getNext"]())&&c._changed());this._path._changed(v.GEOMETRY)}},getPoint:function(){return this._point},setPoint:function(a){a=j.read(arguments);this._point.set(a.x,a.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(a){a=j.read(arguments);
this._handleIn.set(a.x,a.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(a){a=j.read(arguments);this._handleOut.set(a.x,a.y)},_isSelected:function(a){var b=this._selectionState;return a==this._point?!!(b&P.POINT):a==this._handleIn?!!(b&P.HANDLE_IN):a==this._handleOut?!!(b&P.HANDLE_OUT):!1},_setSelected:function(a,b){var c=this._path,b=!!b,d=this._selectionState||0,e=[!!(d&P.POINT),!!(d&P.HANDLE_IN),!!(d&P.HANDLE_OUT)];if(a==this._point){if(b)e[1]=e[2]=!1;else{var f=this.getPrevious(),
g=this.getNext();e[1]=f&&(f._point.isSelected()||f._handleOut.isSelected());e[2]=g&&(g._point.isSelected()||g._handleIn.isSelected())}e[0]=b}else f=a==this._handleIn?1:2,e[f]!=b&&(b&&(e[0]=!1),e[f]=b,c._changed(v.ATTRIBUTE));this._selectionState=(e[0]?P.POINT:0)|(e[1]?P.HANDLE_IN:0)|(e[2]?P.HANDLE_OUT:0);c&&d!=this._selectionState&&c._updateSelection(this,d,this._selectionState)},isSelected:function(){return this._isSelected(this._point)},setSelected:function(a){this._setSelected(this._point,a)},
getIndex:function(){return void 0!==this._index?this._index:null},getPath:function(){return this._path||null},getCurve:function(){if(this._path){var a=this._index;!this._path._closed&&a==this._path._segments.length-1&&a--;return this._path.getCurves()[a]||null}return null},getNext:function(){var a=this._path&&this._path._segments;return a&&(a[this._index+1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._segments;return a&&(a[this._index-1]||this._path._closed&&
a[a.length-1])||null},reverse:function(){return new q(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new q(this._point,this._handleIn,this._handleOut)},equals:function(a){return a==this||a&&this._point.equals(a._point)&&this._handleIn.equals(a._handleIn)&&this._handleOut.equals(a._handleOut)},toString:function(){var a=["point: "+this._point];this._handleIn.isZero()||a.push("handleIn: "+this._handleIn);
this._handleOut.isZero()||a.push("handleOut: "+this._handleOut);return"{ "+a.join(", ")+" }"},_transformCoordinates:function(a,b,c){var d=this._point,e=!c||!this._handleIn.isZero()?this._handleIn:null,f=!c||!this._handleOut.isZero()?this._handleOut:null,g=d._x,h=d._y,i=2;b[0]=g;b[1]=h;e&&(b[i++]=e._x+g,b[i++]=e._y+h);f&&(b[i++]=f._x+g,b[i++]=f._y+h);if(a)if(a._transformCoordinates(b,0,b,0,i/2),g=b[0],h=b[1],c){if(d._x=g,d._y=h,i=2,e&&(e._x=b[i++]-g,e._y=b[i++]-h),f)f._x=b[i++]-g,f._y=b[i++]-h}else if(e||
(b[i++]=g,b[i++]=h),!f)b[i++]=g,b[i++]=h}}),na=j.extend({set:function(a,b){this._x=a;this._y=b;this._owner._changed(this);return this},getX:function(){return this._x},setX:function(a){this._x=a;this._owner._changed(this)},getY:function(){return this._y},setY:function(a){this._y=a;this._owner._changed(this)},isZero:function(){return 0==this._x&&0==this._y},setSelected:function(a){this._owner._setSelected(this,a)},isSelected:function(){return this._owner._isSelected(this)},statics:{create:function(a,
b,c){var d=new na(na.dont),e,f,g;if(c)if(void 0!==(e=c[0]))f=c[1];else{if(void 0===(e=c.x))c=j.read(arguments,2,1),e=c.x;f=c.y;g=c.selected}else e=f=0;d._x=e;d._y=f;d._owner=a;a[b]=d;g&&d.setSelected(!0);return d}}}),P={HANDLE_IN:1,HANDLE_OUT:2,POINT:4},J=this.Curve=o.extend({initialize:function(a,b,c,d,e,f,g,h){var i=arguments.length;if(0==i)this._segment1=new q,this._segment2=new q;else if(1==i)this._segment1=new q(a.segment1),this._segment2=new q(a.segment2);else if(2==i)this._segment1=new q(a),
this._segment2=new q(b);else if(4==i)this._segment1=new q(a,null,b),this._segment2=new q(d,c,null);else if(8==i){var i=j.create(a,b),m=j.create(g,h);this._segment1=new q(i,null,j.create(c,d).subtract(i));this._segment2=new q(m,j.create(e,f).subtract(m),null)}},_changed:function(){delete this._length},getPoint1:function(){return this._segment1._point},setPoint1:function(a){a=j.read(arguments);this._segment1._point.set(a.x,a.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(a){a=
j.read(arguments);this._segment2._point.set(a.x,a.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(a){a=j.read(arguments);this._segment1._handleOut.set(a.x,a.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(a){a=j.read(arguments);this._segment2._handleIn.set(a.x,a.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},
getNext:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index+1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index-1]||this._path._closed&&a[a.length-1])||null},isSelected:function(){return this.getHandle1().isSelected()&&this.getHandle2().isSelected()},setSelected:function(a){this.getHandle1().setSelected(a);this.getHandle2().setSelected(a)},getValues:function(){return J.getValues(this._segment1,
this._segment2)},getPoints:function(){for(var a=this.getValues(),b=[],c=0;8>c;c+=2)b.push(j.create(a[c],a[c+1]));return b},getLength:function(){var a=arguments[0],b=arguments[1];if((fullLength=0==arguments.length||0==a&&1==b)&&null!=this._length)return this._length;a=J.getLength(this.getValues(),a,b);fullLength&&(this._length=a);return a},getPart:function(a,b){return new J(J.getPart(this.getValues(),a,b))},isLinear:function(){return this._segment1._handleOut.isZero()&&this._segment2._handleIn.isZero()},
getParameterAt:function(a,b){return J.getParameterAt(this.getValues(),a,void 0!==b?b:0>a?1:0)},getPoint:function(a){return J.evaluate(this.getValues(),a,0)},getTangent:function(a){return J.evaluate(this.getValues(),a,1)},getNormal:function(a){return J.evaluate(this.getValues(),a,2)},getParameter:function(a){a=j.read(a);return J.getParameter(this.getValues(),a.x,a.y)},getCrossings:function(a,b){for(var c=this.getValues(),d=J.solveCubic(c,1,a.y,b),e=0,f=0;f<d;f++){var g=b[f];0<=g&&(1>g&&J.evaluate(c,
g,0).x>a.x)&&!(g<E.TOLERANCE&&0<=J.evaluate(this.getPrevious().getValues(),1,1).y*J.evaluate(c,g,1).y)&&e++}return e},reverse:function(){return new J(this._segment2.reverse(),this._segment1.reverse())},clone:function(){return new J(this._segment1,this._segment2)},toString:function(){var a=["point1: "+this._segment1._point];this._segment1._handleOut.isZero()||a.push("handle1: "+this._segment1._handleOut);this._segment2._handleIn.isZero()||a.push("handle2: "+this._segment2._handleIn);a.push("point2: "+
this._segment2._point);return"{ "+a.join(", ")+" }"},statics:{create:function(a,b,c){var d=new J(J.dont);d._path=a;d._segment1=b;d._segment2=c;return d},getValues:function(a,b){var c=a._point,d=a._handleOut,e=b._handleIn,f=b._point;return[c._x,c._y,c._x+d._x,c._y+d._y,f._x+e._x,f._y+e._y,f._x,f._y]},evaluate:function(a,b,c){var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],m=a[6],a=a[7],l,n;if(0==c&&(0==b||1==b))l=0==b?d:m,n=0==b?e:a;else{var p=E.TOLERANCE;b<p&&f==d&&g==e?b=p:b>1-p&&(h==m&&i==a)&&(b=
1-p);p=3*(f-d);f=3*(h-f)-p;m=m-d-p-f;h=3*(g-e);g=3*(i-g)-h;i=a-e-h-g;switch(c){case 0:l=((m*b+f)*b+p)*b+d;n=((i*b+g)*b+h)*b+e;break;case 1:case 2:l=(3*m*b+2*f)*b+p,n=(3*i*b+2*g)*b+h}}return 2==c?new j(n,-l):new j(l,n)},subdivide:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],m=a[7];void 0===b&&(b=0.5);var l=1-b,n=l*c+b*e,p=l*d+b*f,M=l*e+b*g,s=l*f+b*h,g=l*g+b*i,h=l*h+b*m,f=l*n+b*M,e=l*p+b*s,M=l*M+b*g,s=l*s+b*h,j=l*f+b*M,l=l*e+b*s;return[[c,d,n,p,f,e,j,l],[j,l,M,s,g,h,i,m]]},solveCubic:function(a,
b,c,d){var e=a[b],f=a[b+2],g=3*(f-e),f=3*(a[b+4]-f)-g;return E.solveCubic(a[b+6]-e-g-f,f,g,e-c,d,E.TOLERANCE)},getParameter:function(a,b,c){for(var d=[],e=[],b=J.solveCubic(a,0,b,d),a=J.solveCubic(a,1,c,e),f,g,c=0;-1==b||c<b;)if(-1==b||0<=(f=d[c++])&&1>=f){for(var h=0;-1==a||h<a;)if(-1==a||0<=(g=e[h++])&&1>=g)if(-1==b?f=g:-1==a&&(g=f),Math.abs(f-g)<E.TOLERANCE)return 0.5*(f+g);if(-1==b)break}return null},getPart:function(a,b,c){0<b&&(a=J.subdivide(a,b)[1]);1>c&&(a=J.subdivide(a,(c-b)/(1-b))[0]);return a},
isFlatEnough:function(a){var b=a[0],c=a[1],d=a[6],e=a[7],f=3*a[2]-2*b-d,g=3*a[3]-2*c-e,b=3*a[4]-2*d-b,a=3*a[5]-2*e-c;return 1>Math.max(f*f,b*b)+Math.max(g*g,a*a)}}},new function(){function a(a){var b=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],m=9*(f-h)+3*(a[6]-b),l=6*(b+h)-12*f,n=3*(f-b),p=9*(g-i)+3*(a[7]-e),j=6*(e+i)-12*g,s=3*(g-e);return function(a){var b=(m*a+l)*a+n,a=(p*a+j)*a+s;return Math.sqrt(b*b+a*a)}}function b(a,b){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(b-a))))}return{statics:!0,
getLength:function(c,d,e){void 0===d&&(d=0);void 0===e&&(e=1);if(c[0]==c[2]&&c[1]==c[3]&&c[6]==c[4]&&c[7]==c[5]){var f=c[6]-c[0],c=c[7]-c[1];return(e-d)*Math.sqrt(f*f+c*c)}f=a(c);return E.integrate(f,d,e,b(d,e))},getParameterAt:function(c,d,e){if(0==d)return e;var f=0<d,g=f?e:0,h=f?1:e,d=Math.abs(d),i=a(c),c=E.integrate(i,g,h,b(g,h));if(d>=c)return f?h:g;var c=d/c,m=0;return E.findRoot(function(a){var c=b(e,a);m+=e<a?E.integrate(i,e,a,c):-E.integrate(i,a,e,c);e=a;return m-d},i,f?g+c:h-c,g,h,16,E.TOLERANCE)}}},
new function(){function a(d,g){for(var h=0,i=null,m=0,l=d.length;m<l;m++){var n=0>d[m].y?-1:1;null!=i&&n!=i&&h++;i=n}switch(h){case 0:return[];case 1:if(g>=b)return[0.5*(d[0].x+d[5].x)];for(var h=d.length-1,i=d[0].y-d[h].y,m=d[h].x-d[0].x,l=d[0].x*d[h].y-d[h].x*d[0].y,p=n=0,M=1;M<h;M++){var s=i*d[M].x+m*d[M].y+l,u=s*s;0>s&&u>p?p=u:u>n&&(n=u)}if(Math.abs((n+p)/(2*i*(i*i+m*m)))<c)return h=new V(d[0],d[5],!0),[h.vector.getLength(!0)<=E.EPSILON?h.point.x:e.intersect(h).x]}h=[[]];i=[];m=[];for(l=0;5>=
l;l++)h[0][l]=new j(d[l]);for(n=1;5>=n;n++){h[n]=[];for(l=0;l<=5-n;l++)h[n][l]=h[n-1][l].add(h[n-1][l+1]).multiply(0.5)}for(l=0;5>=l;l++)i[l]=h[l][0],m[l]=h[5-l][l];return a(i,g+1).concat(a(m,g+1))}var b=32,c=Math.pow(2,-b-1),d=[[1,0.6,0.3,0.1],[0.4,0.6,0.6,0.4],[0.1,0.3,0.6,1]],e=new V(new j(0,0),new j(1,0));return{getNearestLocation:function(b){for(var c=this.getPoints(),e=[],i=[],m=[],l=[],n=0;3>=n;n++)e[n]=c[n].subtract(b),3>n&&(i[n]=c[n+1].subtract(c[n]).multiply(3));for(n=0;3>n;n++){m[n]=[];
for(c=0;3>=c;c++)m[n][c]=i[n].dot(e[c])}for(n=0;5>=n;n++)l[n]=new j(n/5,0);for(k=0;5>=k;k++){i=Math.max(0,k-3+1);e=Math.min(k,3);for(n=i;n<=e;n++)i=k-n,l[k].y+=m[i][n]*d[i][n]}for(var m=a(l,0).concat([0,1]),l=Infinity,p,M,e=0;e<m.length;e++)i=this.getPoint(m[e]),n=b.getDistance(i,!0),n<l&&(l=n,p=m[e],M=i);return new CurveLocation(this,p,M,Math.sqrt(l))},getNearestPoint:function(a){return this.getNearestLocation(a).getPoint()}}});CurveLocation=o.extend({initialize:function(a,b,c,d){this._curve=a;this._parameter=
b;this._point=c;this._distance=d},getSegment:function(){if(!this._segment){var a=this._curve,b=this.getParameter();if(0==b)this._segment=a._segment1;else if(1==b)this._segment=a._segment2;else{if(null==b)return null;this._segment=a.getLength(0,b)<a.getLength(b,1)?a._segment1:a._segment2}}return this._segment},getCurve:function(){return this._curve},getPath:function(){return this._curve&&this._curve._path},getIndex:function(){return this._curve&&this._curve.getIndex()},getOffset:function(){var a=this._curve&&
this._curve._path;return a&&a._getOffset(this)},getCurveOffset:function(){var a=this.getParameter();return null!=a&&this._curve&&this._curve.getLength(0,a)},getParameter:function(){null==this._parameter&&(this._curve&&this._point)&&(this._parameter=this._curve.getParameterAt(this._point));return this._parameter},getPoint:function(){!this._point&&(this._curve&&null!=this._parameter)&&(this._point=this._curve.getPoint(this._parameter));return this._point},getTangent:function(){var a=this.getParameter();
return null!=a&&this._curve&&this._curve.getTangent(a)},getNormal:function(){var a=this.getParameter();return null!=a&&this._curve&&this._curve.getNormal(a)},getDistance:function(){return this._distance},toString:function(){var a=[],b=this.getPoint();b&&a.push("point: "+b);b=this.getIndex();null!=b&&a.push("index: "+b);b=this.getParameter();null!=b&&a.push("parameter: "+o.formatNumber(b));null!=this._distance&&a.push("distance: "+o.formatNumber(this._distance));return"{ "+a.join(", ")+" }"}});var ma=
this.PathItem=D.extend({}),O=this.Path=ma.extend({initialize:function(a){this.base();this._closed=!1;this._selectedSegmentState=0;this.setSegments(!a||!Array.isArray(a)||"object"!==typeof a[0]?arguments:a)},clone:function(){var a=this._clone(new O(this._segments));a._closed=this._closed;void 0!==this._clockwise&&(a._clockwise=this._clockwise);return a},_changed:function(a){D.prototype._changed.call(this,a);if(a&4){if(delete this._length,delete this._clockwise,null!=this._curves)for(var a=0,b=this._curves.length;a<
b;a++)this._curves[a]._changed(v.GEOMETRY)}else a&8&&delete this._bounds},getSegments:function(){return this._segments},setSegments:function(a){this._segments?(this._selectedSegmentState=0,this._segments.length=0,this._curves&&delete this._curves):this._segments=[];this._add(q.readAll(a))},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){if(!this._curves){var a=this._segments,b=a.length;!this._closed&&
0<b&&b--;this._curves=Array(b);for(var c=0;c<b;c++)this._curves[c]=J.create(this,a[c],a[c+1]||a[0])}return this._curves},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var a=this.getCurves();return a[a.length-1]},getClosed:function(){return this._closed},setClosed:function(a){if(this._closed!=(a=!!a)){this._closed=a;if(this._curves){var b=this._segments.length,c;!a&&0<b&&b--;this._curves.length=b;a&&(this._curves[c=b-1]=J.create(this,this._segments[c],this._segments[0]))}this._changed(v.GEOMETRY)}},
transform:function(a){return this.base(a,!0)},getMatrix:function(){return null},setMatrix:function(){},_apply:function(a){for(var b=Array(6),c=0,d=this._segments.length;c<d;c++)this._segments[c]._transformCoordinates(a,b,!0);c=this._style;b=c._fillColor;c=c._strokeColor;b&&b.transform&&b.transform(a);c&&c.transform&&c.transform(a);return!0},_add:function(a,b){for(var c=this._segments,d=this._curves,e=a.length,f=null==b,b=f?c.length:b,g=this.isFullySelected(),h=0;h<e;h++){var i=a[h];i._path&&(i=a[h]=
new q(i));i._path=this;i._index=b+h;g&&(i._selectionState=P.POINT);i._selectionState&&this._updateSelection(i,0,i._selectionState)}if(f)c.push.apply(c,a);else{c.splice.apply(c,[b,0].concat(a));h=b+e;for(f=c.length;h<f;h++)c[h]._index=h}if(d&&0<=--b&&(d.splice(b,0,J.create(this,c[b],c[b+1])),d=d[b+e]))d._segment1=c[b+e];this._changed(v.GEOMETRY);return a},add:function(a){return 1<arguments.length&&"number"!==typeof a?this._add(q.readAll(arguments)):this._add([q.read(arguments)])[0]},insert:function(a,
b){return 2<arguments.length&&"number"!==typeof b?this._add(q.readAll(arguments,1),a):this._add([q.read(arguments,1)],a)[0]},addSegment:function(a){return this._add([q.read(arguments)])[0]},insertSegment:function(a,b){return this._add([q.read(arguments,1)],a)[0]},addSegments:function(a){return this._add(q.readAll(a))},insertSegments:function(a,b){return this._add(q.readAll(b),a)},removeSegment:function(a){return this.removeSegments(a,a+1)[0]||null},removeSegments:function(a,b){var a=a||0,b=o.pick(b,
this._segments.length),c=this._segments,d=this._curves,e=b>=c.length,f=c.splice(a,b-a),g=f.length;if(!g)return f;for(var h=0;h<g;h++){var i=f[h];i._selectionState&&this._updateSelection(i,i._selectionState,0);f._index=f._path=void 0}h=a;for(i=c.length;h<i;h++)c[h]._index=h;if(d){d.splice(a,g);if(g=d[a-1])g._segment2=c[a];if(g=d[a])g._segment1=c[a];if(e&&this._closed&&(g=d[d.length-1]))g._segment2=c[0]}this._changed(v.GEOMETRY);return f},isFullySelected:function(){return this._selected&&this._selectedSegmentState==
this._segments.length*P.POINT},setFullySelected:function(a){var b=this._segments.length;this._selectedSegmentState=a?b*P.POINT:0;for(var c=0;c<b;c++)this._segments[c]._selectionState=a?P.POINT:0;this.setSelected(a)},_updateSelection:function(a,b,c){a._selectionState=c;0<(this._selectedSegmentState+=c-b)&&this.setSelected(!0)},flatten:function(a){for(var b=new xa(this),c=0,a=b.length/Math.ceil(b.length/a),d=b.length+(this._closed?-a:a)/2,e=[];c<=d;)e.push(new q(b.evaluate(c,0))),c+=a;this.setSegments(e)},
simplify:function(a){2<this._segments.length&&(a=new Ba(this,a||2.5),this.setSegments(a.fit()))},isClockwise:function(){function a(a,e){void 0!==c&&(b+=(c-a)*(e+d));c=a;d=e}if(void 0!==this._clockwise)return this._clockwise;for(var b=0,c,d,e=0,f=this._segments.length;e<f;e++){var g=this._segments[e],h=this._segments[e+1<f?e+1:0],i=g._point,g=g._handleOut,m=h._handleIn,h=h._point;a(i._x,i._y);a(i._x+g._x,i._y+g._y);a(h._x+m._x,h._y+m._y);a(h._x,h._y)}return 0<b},setClockwise:function(a){if(this.isClockwise()!=
(a=!!a))this.reverse(),this._clockwise=a},reverse:function(){this._segments.reverse();for(var a=0,b=this._segments.length;a<b;a++){var c=this._segments[a],d=c._handleIn;c._handleIn=c._handleOut;c._handleOut=d;c._index=a}void 0!==this._clockwise&&(this._clockwise=!this._clockwise)},join:function(a){if(a){var b=a._segments,c=this.getLastSegment(),d=a.getLastSegment();c._point.equals(d._point)&&a.reverse();d=a.getFirstSegment();if(c._point.equals(d._point))c.setHandleOut(d._handleOut),this._add(b.slice(1));
else{var e=this.getFirstSegment();e._point.equals(d._point)&&a.reverse();d=a.getLastSegment();e._point.equals(d._point)?(e.setHandleIn(d._handleIn),this._add(b.slice(0,b.length-1),0)):this._add(b.slice(0))}a.remove();e=this.getFirstSegment();c=this.getLastSegment();c._point.equals(e._point)&&(e.setHandleIn(c._handleIn),c.remove(),this.setClosed(!0));this._changed(v.GEOMETRY);return!0}return!1},getLength:function(){if(null==this._length)for(var a=this.getCurves(),b=this._length=0,c=a.length;b<c;b++)this._length+=
a[b].getLength();return this._length},_getOffset:function(a){var b=a&&a.getIndex();if(null!=b){for(var c=this.getCurves(),d=0,e=0;e<b;e++)d+=c[e].getLength();return d+c[b].getLength(0,a.getParameter())}return null},getLocation:function(a){for(var b=this.getCurves(),c=0,d=b.length;c<d;c++){var e=b[c],f=e.getParameter(a);if(null!=f)return new CurveLocation(e,f)}return null},getLocationAt:function(a,b){var c=this.getCurves(),d=0;if(b)return d=~~a,new CurveLocation(c[d],a-d);for(var e=0,f=c.length;e<
f;e++){var g=d,h=c[e],d=d+h.getLength();if(d>=a)return new CurveLocation(h,h.getParameterAt(a-g))}return a<=this.getLength()?new CurveLocation(c[c.length-1],1):null},getPointAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getPoint()},getTangentAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getTangent()},getNormalAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getNormal()},getNearestLocation:function(a){for(var b=this.getCurves(),c=Infinity,d=null,e=0,f=b.length;e<
f;e++){var g=b[e].getNearestLocation(a);g._distance<c&&(c=g._distance,d=g)}return d},getNearestPoint:function(a){return this.getNearestLocation(a).getPoint()},contains:function(a){a=j.read(arguments);if(!this._closed||!this.getRoughBounds()._containsPoint(a))return!1;for(var b=this.getCurves(),c=0,d=[],e=0,f=b.length;e<f;e++)c+=b[e].getCrossings(a,d);return 1==(c&1)},_hitTest:function(a,b){function c(b,c,d){if(a.getDistance(c)<f)return new HitResult(d,m,{segment:b,point:c})}function d(a,d){var e=
a._point;return(d||b.segments)&&c(a,e,"segment")||!d&&b.handles&&(c(a,e.add(a._handleIn),"handle-in")||c(a,e.add(a._handleOut),"handle-out"))}var e=this._style,f=b.tolerance||0,g=(b.stroke&&e._strokeColor?e._strokeWidth/2:0)+f,h,i,m=this;if(b.ends&&!b.segments&&!this._closed){if(i=d(this.getFirstSegment(),!0)||d(this.getLastSegment(),!0))return i}else if(b.segments||b.handles)for(var l=0,n=this._segments.length;l<n;l++)if(i=d(this._segments[l]))return i;b.stroke&&0<g&&(h=this.getNearestLocation(a));
if(!(h&&h._distance<=g)&&b.fill&&e._fillColor&&this.contains(a))return new HitResult("fill",this);!h&&(b.stroke&&0<g)&&(h=this.getNearestLocation(a));if(h&&h._distance<=g)return b.stroke?new HitResult("stroke",this,{location:h}):new HitResult("fill",this)}},new function(){function a(a,c,d){function e(c){c=f[c];if(d)c._transformCoordinates(d,h,!1),m=h[0],l=h[1];else{var e=c._point;m=e._x;l=e._y}i?(a.moveTo(m,l),i=!1):(d?(n=h[2],p=h[3]):(e=c._handleIn,n=m+e._x,p=l+e._y),n==m&&p==l&&j==m&&s==l?a.lineTo(m,
l):a.bezierCurveTo(j,s,n,p,m,l));d?(j=h[4],s=h[5]):(e=c._handleOut,j=m+e._x,s=l+e._y)}for(var f=c._segments,g=f.length,h=Array(6),i=!0,m,l,n,p,j,s,u=0;u<g;u++)e(u);c._closed&&1<g&&e(0)}return{draw:function(b,c){c.compound||b.beginPath();var d=this._style,e=d._fillColor,f=d._strokeColor,g=d._dashArray,h=f&&g&&g.length;(c.compound||this._clipMask||e||f&&!h)&&a(b,this);this._closed&&b.closePath();if(this._clipMask)b.clip();else if(!c.compound&&(e||f)){b.save();this._setStyles(b);e&&b.fill();if(f){if(h){b.beginPath();
e=new xa(this);d=d._dashOffset;for(h=0;d<e.length;)f=d+g[h++%g.length],e.drawPart(b,d,f),d=f+g[h++%g.length]}b.stroke()}b.restore()}},drawSelected:function(b,c){b.beginPath();a(b,this,c);b.stroke();for(var d=this._segments,e=Array(6),f=0,g=d.length;f<g;f++){var h=d[f];h._transformCoordinates(c,e,!1);var h=h._selectionState,i=h&P.POINT,m=e[0],l=e[1],n=function(a){var c=e[a],a=e[a+1];if(m!=c||l!=a)b.beginPath(),b.moveTo(m,l),b.lineTo(c,a),b.stroke(),b.beginPath(),b.arc(c,a,1.75,0,2*Math.PI,!0),b.fill()};
(i||h&P.HANDLE_IN)&&n(2);(i||h&P.HANDLE_OUT)&&n(4);b.save();b.beginPath();b.rect(m-2,l-2,4,4);b.fill();i||(b.beginPath(),b.rect(m-1,l-1,2,2),b.fillStyle="#ffffff",b.fill());b.restore()}}}},new function(){function a(a){var c=a.length,d=[],e=[],f=2;d[0]=a[0]/f;for(var g=1;g<c;g++)e[g]=1/f,f=(g<c-1?4:2)-e[g],d[g]=(a[g]-d[g-1])/f;for(g=1;g<c;g++)d[c-g-1]-=e[c-g]*d[c-g];return d}return{smooth:function(){var b=this._segments,c=b.length,d=c,e;if(!(2>=c)){this._closed?(e=Math.min(c,4),d+=2*Math.min(c,e)):
e=0;for(var f=[],g=0;g<c;g++)f[g+e]=b[g]._point;if(this._closed)for(g=0;g<e;g++)f[g]=b[g+c-e]._point,f[g+c+e]=b[g]._point;else d--;for(var h=[],g=1;g<d-1;g++)h[g]=4*f[g]._x+2*f[g+1]._x;h[0]=f[0]._x+2*f[1]._x;h[d-1]=3*f[d-1]._x;for(var i=a(h),g=1;g<d-1;g++)h[g]=4*f[g]._y+2*f[g+1]._y;h[0]=f[0]._y+2*f[1]._y;h[d-1]=3*f[d-1]._y;h=a(h);if(this._closed){for(g=0;g<e;g++,c++){var m=g/e,l=1-m;i[c]=i[g]*m+i[c]*l;h[c]=h[g]*m+h[c]*l;var n=g+e,p=c+e;i[p]=i[n]*l+i[p]*m;h[p]=h[n]*l+h[p]*m}d--}c=null;for(g=e;g<=d-
e;g++)m=b[g-e],c&&m.setHandleIn(c.subtract(m._point)),g<d&&(m.setHandleOut(j.create(i[g],h[g]).subtract(m._point)),c=g<d-1?j.create(2*f[g+1]._x-i[g+1],2*f[g+1]._y-h[g+1]):j.create((f[d]._x+i[d-1])/2,(f[d]._y+h[d-1])/2));this._closed&&c&&(m=this._segments[0],m.setHandleIn(c.subtract(m._point)))}}}},new function(){function a(a){a=a._segments;if(0==a.length)throw Error("Use a moveTo() command first");return a[a.length-1]}return{moveTo:function(a){this._segments.length||this._add([new q(j.read(arguments))])},
moveBy:function(){throw Error("moveBy() is unsupported on Path items.");},lineTo:function(a){this._add([new q(j.read(arguments))])},cubicCurveTo:function(b,c,d){var b=j.read(arguments,0,1),c=j.read(arguments,1,1),d=j.read(arguments,2,1),e=a(this);e.setHandleOut(b.subtract(e._point));this._add([new q(d,c.subtract(d))])},quadraticCurveTo:function(b,c){var b=j.read(arguments,0,1),c=j.read(arguments,1,1),d=a(this)._point;this.cubicCurveTo(b.add(d.subtract(b).multiply(1/3)),b.add(c.subtract(b).multiply(1/
3)),c)},curveTo:function(b,c,d){var b=j.read(arguments,0,1),c=j.read(arguments,1,1),e=o.pick(d,0.5),f=1-e,g=a(this)._point,f=b.subtract(g.multiply(f*f)).subtract(c.multiply(e*e)).divide(2*e*f);if(f.isNaN())throw Error("Cannot put a curve through points with parameter = "+e);this.quadraticCurveTo(f,c)},arcTo:function(b,c){var d=a(this),e=d._point,f;void 0===c&&(c=!0);if("boolean"===typeof c){var b=j.read(arguments,0,1),g=e.add(b).divide(2);f=g.add(g.subtract(e).rotate(c?-90:90))}else f=j.read(arguments,
0,1),b=j.read(arguments,1,1);var g=new V(e.add(f).divide(2),f.subtract(e).rotate(90)),h=new V(f.add(b).divide(2),b.subtract(f).rotate(90)),g=g.intersect(h),i=new V(e,b,!0),h=i.getSide(f);if(!g){if(!h)return this.lineTo(b);throw Error("Cannot put an arc through the given points: "+[e,f,b]);}e=e.subtract(g);e.getLength();f=e.getDirectedAngle(b.subtract(g));i=i.getSide(g);0==i?f=h*Math.abs(f):h==i&&(f-=360*(0>f?-1:1));h=Math.abs(f);h=360<=h?4:Math.ceil(h/90);f/=h;for(var i=f*Math.PI/360,i=4/3*Math.sin(i)/
(1+Math.cos(i)),m=[],l=0;l<=h;l++){var n=l<h?g.add(e):b,p=l<h?e.rotate(90).multiply(i):null;0==l?d.setHandleOut(p):m.push(new q(n,e.rotate(-90).multiply(i),p));e=e.rotate(f)}this._add(m)},lineBy:function(b){var b=j.read(arguments),c=a(this);this.lineTo(c._point.add(b))},curveBy:function(b,c,d){var b=j.read(b),c=j.read(c),e=a(this)._point;this.curveTo(e.add(b),e.add(c),d)},arcBy:function(b,c){var b=j.read(b),c=j.read(c),d=a(this)._point;this.arcBy(d.add(b),d.add(c))},closePath:function(){this.setClosed(!0)}}},
new function(){function a(a,b){function c(g){g._transformCoordinates(a,i,!1);for(var h=0;2>h;h++){var f=m[h],s=m[h+4],u=i[h+2],o=i[h],g=function(a,c){var d=0;if(null==a)var g=1-c,a=g*g*g*f+3*g*g*c*s+3*g*c*c*u+c*c*c*o,d=b?b[h]:0;g=a-d;d=a+d;g<l[h]&&(l[h]=g);d>n[h]&&(n[h]=d)};g(o,null);var q=3*(s-u)-f+o,H=2*(f+u)-4*s,r=s-f;if(0==q)0!=H&&(H=-r/H,p<H&&H<j&&g(null,H));else if(r=H*H-4*q*r,!(0>r)){var r=Math.sqrt(r),t=-0.5/q,q=(H-r)*t,H=(H+r)*t;p<q&&q<j&&g(null,q);p<H&&H<j&&g(null,H)}}g=m;m=i;i=g}var g=
this._segments,h=g[0];if(!h)return null;var i=Array(6),m=Array(6);h._transformCoordinates(a,m,!1);for(var l=m.slice(0,2),n=l.slice(0),p=E.TOLERANCE,j=1-p,s=1,u=g.length;s<u;s++)c(g[s]);this._closed&&c(h);return t.create(l[0],l[1],n[0]-l[0],n[1]-l[1])}function b(a,b,c){for(var g=Array(6),h=Infinity,i=-h,m=h,l=i,b=b/2||0,c=c/2||0,n=0,p=this._segments.length;n<p;n++){this._segments[n]._transformCoordinates(a,g,!1);for(var j=0;6>j;j+=2){var s=0==j?c:b,u=g[j],o=g[j+1],w=u-s,u=u+s,aa=o-s,s=o+s;w<h&&(h=
w);u>i&&(i=u);aa<m&&(m=aa);s>l&&(l=s)}}return t.create(h,m,i-h,l-m)}var c={bounds:a,strokeBounds:function(b){function c(a){aa=aa.include(b?b._transformPoint(a,a):a)}function f(a,b){var d=a.getPoint(b),g=a.getNormal(b).normalize(l);c(d.add(g));c(d.subtract(g))}function g(a,h){if("round"===h||!a._handleIn.isZero()&&!a._handleOut.isZero())aa=aa.unite(q.setCenter(b?b._transformPoint(a._point):a._point));else if("bevel"==h){var i=a.getCurve();f(i,0);f(i.getPrevious(),1)}else if("miter"==h){var m=a.getCurve(),
n=m.getPrevious(),i=m.getPoint(0),n=n.getNormal(1).normalize(l),m=m.getNormal(0).normalize(l),n=new V(i.subtract(n),j.create(-n.y,n.x)),m=new V(i.subtract(m),j.create(-m.y,m.x)),m=n.intersect(m);!m||i.getDistance(m)>w?g(a,"bevel"):c(m)}}function h(a,b,d){switch(b){case "round":return g(a,b);case "butt":case "square":var h=a.getCurve(),a=h.getPoint(d),h=h.getNormal(d).normalize(l);"square"===b&&(a=a.add(h.rotate(0==d?-90:90)));c(a.add(h));c(a.subtract(h))}}var i=this._style;if(!i._strokeColor||!i._strokeWidth)return a.call(this,
b);var m=i._strokeWidth,l=m/2,n;var p=l;if(b){n=b.createShiftless();var M=n.transform(j.create(p,0)),p=n.transform(j.create(0,p)),s=M.getAngleInRadians(),M=M.getLength(),p=p.getLength();n=Math.sin(s);var o=Math.cos(s),y=Math.tan(s),s=-Math.atan(p*y/M),y=Math.atan(p/(y*M));n=[Math.abs(M*Math.cos(s)*o-p*Math.sin(s)*n),Math.abs(p*Math.sin(y)*o+M*Math.cos(y)*n)]}else n=[p,p];var M=i._strokeJoin,p=i._strokeCap,w=i._miterLimit*m/2,i=this._segments,m=i.length,aa=a.call(this,b,n),q=new t((new r(n)).multiply(2));
n=1;for(o=m-(this._closed?0:1);n<o;n++)g(i[n],M);this._closed?g(i[0],M):(h(i[0],p,0),h(i[m-1],p,1));return aa},handleBounds:b,roughBounds:function(a){var c=this._style,f=c._strokeWidth;return b.call(this,a,f,"miter"==c._strokeJoin?f*c._miterLimit:f)}};return{_getBounds:function(a,b){return c[a].call(this,b)}}});O.inject({statics:new function(){var a=2/3*(Math.sqrt(2)-1),b=[new q([0,0.5],[0,a],[0,-a]),new q([0.5,0],[-a,0],[a,0]),new q([1,0.5],[0,-a],[0,a]),new q([0.5,1],[a,0],[-a,0])];return{Line:function(){var a=
Math.floor(arguments.length/2);return new O(q.read(arguments,0,a),q.read(arguments,a,a))},Rectangle:function(a){var a=t.read(arguments),b=a.x,e=a.y,f=b+a.width,g=e+a.height,h=new O;h._add([new q(j.create(b,g)),new q(j.create(b,e)),new q(j.create(f,e)),new q(j.create(f,g))]);h._closed=!0;return h},RoundRectangle:function(b,d){2==arguments.length?(b=t.read(arguments,0,1),d=r.read(arguments,1,1)):6==arguments.length&&(b=t.read(arguments,0,4),d=r.read(arguments,4,2));var d=r.min(d,b.getSize(!0).divide(2)),
e=new O,f=d.multiply(2*a),g=b.getBottomLeft(!0),h=b.getTopLeft(!0),i=b.getTopRight(!0),m=b.getBottomRight(!0);e._add([new q(g.add(d.width,0),null,[-f.width,0]),new q(g.subtract(0,d.height),[0,f.height],null),new q(h.add(0,d.height),null,[0,-f.height]),new q(h.add(d.width,0),[-f.width,0],null),new q(i.subtract(d.width,0),null,[f.width,0]),new q(i.add(0,d.height),[0,-f.height],null),new q(m.subtract(0,d.height),null,[0,f.height]),new q(m.subtract(d.width,0),[f.width,0],null)]);e._closed=!0;return e},
Oval:function(a){for(var a=t.read(arguments),d=new O,e=a.getPoint(!0),f=a.getSize(!0),g=Array(4),h=0;4>h;h++){var i=b[h];g[h]=new q(i._point.multiply(f).add(e),i._handleIn.multiply(f),i._handleOut.multiply(f))}d._add(g);d._closed=!0;return d},Circle:function(a,b){3==arguments.length?(a=j.read(arguments,0,2),b=arguments[2]):a=j.read(arguments,0,1);return O.Oval(new t(a.subtract(b),r.create(2*b,2*b)))},Arc:function(a,b,e){var f=new O;f.moveTo(a);f.arcTo(b,e);return f},RegularPolygon:function(a,b,e){for(var a=
j.read(arguments,0,1),f=new O,g=360/b,h=!(b%3),i=new j(0,h?-e:e),h=h?-1:0.5,m=Array(b),l=0;l<b;l++)m[l]=new q(a.add(i.rotate((l+h)*g)));f._add(m);f._closed=!0;return f},Star:function(a,b,e,f){for(var a=j.read(arguments,0,1),b=2*b,g=new O,h=360/b,i=new j(0,-1),m=Array(b),l=0;l<b;l++)m[l]=new q(a.add(i.rotate(h*l).multiply(l%2?f:e)));g._add(m);g._closed=!0;return g}}}});var wa=this.CompoundPath=ma.extend({initialize:function(a){this.base();this._children=[];this._namedChildren={};var b=!a||!Array.isArray(a)||
"object"!==typeof a[0]?arguments:a;this.addChildren(b)},insertChild:function(a,b){this.base(a,b);void 0===b._clockwise&&b.setClockwise(0==b._index)},simplify:function(){if(1==this._children.length){var a=this._children[0];a.insertAbove(this);this.remove();return a}return this},smooth:function(){for(var a=0,b=this._children.length;a<b;a++)this._children[a].smooth()},draw:function(a,b){var c=this._children;if(0!=c.length){var d=c[0],e=d._style;a.beginPath();b.compound=!0;for(var f=0,g=c.length;f<g;f++)D.draw(c[f],
a,b);d._setStyles(a);e._fillColor&&a.fill();e._strokeColor&&a.stroke();b.compound=!1}}},new function(){function a(a){if(!a._children.length)throw Error("Use a moveTo() command first");return a._children[a._children.length-1]}var b={moveTo:function(a){var b=new O;this.addChild(b);b.moveTo.apply(b,arguments)},moveBy:function(b){this.moveTo(a(this).getLastSegment()._point.add(j.read(arguments)))},closePath:function(){a(this).setClosed(!0)}};o.each("lineTo cubicCurveTo quadraticCurveTo curveTo arcTo lineBy curveBy arcBy".split(" "),
function(c){b[c]=function(){var b=a(this);b[c].apply(b,arguments)}});return b}),xa=o.extend({initialize:function(a){function b(a,b){var c=J.getValues(a,b);f.curves.push(c);f._computeParts(c,a._index,0,1)}this.curves=[];this.parts=[];this.index=this.length=0;for(var c=a._segments,d=c[0],e,f=this,g=1,h=c.length;g<h;g++)e=c[g],b(d,e),d=e;a._closed&&b(e,c[0])},_computeParts:function(a,b,c,d){if(0.03125<d-c&&!J.isFlatEnough(a)){var a=J.subdivide(a),e=(c+d)/2;this._computeParts(a[0],b,c,e);this._computeParts(a[1],
b,e,d)}else c=a[6]-a[0],a=a[7]-a[1],c=Math.sqrt(c*c+a*a),c>E.TOLERANCE&&(this.length+=c,this.parts.push({offset:this.length,value:d,index:b}))},getParameterAt:function(a){for(var b,c=this.index;!(b=c,0==c||this.parts[--c].offset<a););for(var d=this.parts.length;b<d;b++)if(c=this.parts[b],c.offset>=a)return this.index=b,b=(d=this.parts[b-1])&&d.index==c.index?d.value:0,d=d?d.offset:0,{value:b+(c.value-b)*(a-d)/(c.offset-d),index:c.index};c=this.parts[this.parts.length-1];return{value:1,index:c.index}},
evaluate:function(a,b){var c=this.getParameterAt(a);return J.evaluate(this.curves[c.index],c.value,b)},drawPart:function(a,b,c){for(var b=this.getParameterAt(b),c=this.getParameterAt(c),d=b.index;d<=c.index;d++){var e=J.getPart(this.curves[d],d==b.index?b.value:0,d==c.index?c.value:1);d==b.index&&a.moveTo(e[0],e[1]);a.bezierCurveTo.apply(a,e.slice(2))}}}),Ba=o.extend({initialize:function(a,b){this.points=[];for(var c=a._segments,d,e=0,f=c.length;e<f;e++){var g=c[e].point.clone();if(!d||!d.equals(g))this.points.push(g),
d=g}this.error=b},fit:function(){this.segments=[new q(this.points[0])];this.fitCubic(0,this.points.length-1,this.points[1].subtract(this.points[0]).normalize(),this.points[this.points.length-2].subtract(this.points[this.points.length-1]).normalize());return this.segments},fitCubic:function(a,b,c,d){if(1==b-a){var a=this.points[a],b=this.points[b],e=a.getDistance(b)/3;this.addCurve([a,a.add(c.normalize(e)),b.add(d.normalize(e)),b])}else{for(var f=this.chordLengthParameterize(a,b),g=Math.max(this.error,
this.error*this.error),h=0;4>=h;h++){var i=this.generateBezier(a,b,f,c,d),m=this.findMaxError(a,b,i,f);if(m.error<this.error){this.addCurve(i);return}e=m.index;if(m.error>=g)break;this.reparameterize(a,b,f,i);g=m.error}f=this.points[e-1].subtract(this.points[e]);g=this.points[e].subtract(this.points[e+1]);f=f.add(g).divide(2).normalize();this.fitCubic(a,e,c,f);this.fitCubic(e,b,f.negate(),d)}},addCurve:function(a){this.segments[this.segments.length-1].setHandleOut(a[1].subtract(a[0]));this.segments.push(new q(a[3],
a[2].subtract(a[3])))},generateBezier:function(a,b,c,d,e){for(var f=E.EPSILON,g=this.points[a],h=this.points[b],i=[[0,0],[0,0]],m=[0,0],l=0,b=b-a+1;l<b;l++){var n=c[l],p=1-n,j=3*n*p,s=p*p*p,p=j*p,j=j*n,o=n*n*n,n=d.normalize(p),y=e.normalize(j),s=this.points[a+l].subtract(g.multiply(s+p)).subtract(h.multiply(j+o));i[0][0]+=n.dot(n);i[0][1]+=n.dot(y);i[1][0]=i[0][1];i[1][1]+=y.dot(y);m[0]+=n.dot(s);m[1]+=y.dot(s)}var a=i[0][0]*i[1][1]-i[1][0]*i[0][1],w;Math.abs(a)>f?(w=i[0][0]*m[1]-i[1][0]*m[0],m=(m[0]*
i[1][1]-m[1]*i[0][1])/a,w/=a):(a=i[0][0]+i[0][1],i=i[1][0]+i[1][1],m=Math.abs(a)>f?w=m[0]/a:Math.abs(i)>f?w=m[1]/i:w=0);i=h.getDistance(g);f*=i;if(m<f||w<f)m=w=i/3;return[g,g.add(d.normalize(m)),h.add(e.normalize(w)),h]},reparameterize:function(a,b,c,d){for(var e=a;e<=b;e++)c[e-a]=this.findRoot(d,this.points[e],c[e-a])},findRoot:function(a,b,c){for(var d=[],e=[],f=0;2>=f;f++)d[f]=a[f+1].subtract(a[f]).multiply(3);for(f=0;1>=f;f++)e[f]=d[f+1].subtract(d[f]).multiply(2);a=this.evaluate(3,a,c);d=this.evaluate(2,
d,c);e=this.evaluate(1,e,c);b=a.subtract(b);e=d.dot(d)+b.dot(e);return Math.abs(e)<E.TOLERANCE?c:c-b.dot(d)/e},evaluate:function(a,b,c){for(var b=b.slice(),d=1;d<=a;d++)for(var e=0;e<=a-d;e++)b[e]=b[e].multiply(1-c).add(b[e+1].multiply(c));return b[0]},chordLengthParameterize:function(a,b){for(var c=[0],d=a+1;d<=b;d++)c[d-a]=c[d-a-1]+this.points[d].getDistance(this.points[d-1]);for(var d=1,e=b-a;d<=e;d++)c[d]/=c[e];return c},findMaxError:function(a,b,c,d){for(var e=Math.floor((b-a+1)/2),f=0,g=a+1;g<
b;g++){var h=this.evaluate(3,c,d[g-a]).subtract(this.points[g]),h=h.x*h.x+h.y*h.y;h>=f&&(f=h,e=g)}return{error:f,index:e}}}),Q=this.TextItem=D.extend({_boundsType:"bounds",initialize:function(a){this._style=Ca.create(this);this._paragraphStyle=Da.create(this);this.base(a);this.setParagraphStyle();this._content="";this._lines=[]},_clone:function(a){a.setContent(this._content);a.setParagraphStyle(this._paragraphStyle);return this.base(a)},getContent:function(){return this._content},setContent:function(a){this._content=
""+a;this._lines=this._content.split(/\r\n|\n|\r/mg);this._changed(v.CONTENT)},getCharacterStyle:function(){return this.getStyle()},setCharacterStyle:function(a){this.setStyle(a)}}),Ea=this.PointText=Q.extend({initialize:function(a){this.base(a);this._point=this._matrix.getTranslation()},clone:function(){return this._clone(new Ea(this._matrix))},getPoint:function(){return S.create(this,"setPoint",this._point.x,this._point.y)},setPoint:function(a){this.translate(j.read(arguments).subtract(this._point))},
_transform:function(a){a._transformPoint(this._point,this._point)},draw:function(a){if(this._content){this._setStyles(a);var b=this._style,c=this.getLeading(),d=this._lines;a.font=b.getFontStyle();a.textAlign=this.getJustification();for(var e=0,f=d.length;e<f;e++){var g=d[e];b._fillColor&&a.fillText(g,0,0);b._strokeColor&&a.strokeText(g,0,0);a.translate(0,c)}}}},new function(){var a=null;return{_getBounds:function(b,c){a||(a=L.getCanvas(r.create(1,1)).getContext("2d"));var d=this.getJustification(),
e=0;a.font=this._style.getFontStyle();for(var f=0,g=0,h=this._lines.length;g<h;g++)f=Math.max(f,a.measureText(this._lines[g]).width);"left"!==d&&(e-=f/("center"===d?2:1));d=this.getLeading();g=this._lines.length;e=t.create(e,g?d/4+(g-1)*d:0,f,-g*d);return c?c._transformBounds(e,e):e}}}),oa=D.extend({initialize:function(a){var b=a instanceof oa;return o.each(this._defaults,function(c,d){c=a&&a[d]||c;this[d]=c&&b&&c.clone?c.clone():c},this)},statics:{create:function(a){var b=new this(this.dont);b._item=
a;return b},extend:function(a){var b="_"+a._style,c=o.capitalize(a._style),d=a._flags||{},e={};e["get"+c]=function(){return this[b]};e["set"+c]=function(a){this[b].initialize(a)};o.each(a._defaults,function(c,g){var h=!!g.match(/Color$/),i=o.capitalize(g),m="set"+i,l="get"+i;a[m]=function(a){var c=this._item&&this._item._children,a=h?T.read(arguments):a;if(c)for(var e=0,f=c.length;e<f;e++)c[e][b][m](a);else if(c=this["_"+g],c!=a&&(!c||!c.equals||!c.equals(a)))this["_"+g]=a,h&&(c&&c._removeOwner(this._item),
a&&a._addOwner(this._item)),this._item&&this._item._changed(d[g]||v.STYLE);return this};a[l]=function(){var a=this._item&&this._item._children,c;if(!a)return this["_"+g];for(var d=0,e=a.length;d<e;d++){var h=a[d][b][l]();if(c){if(c!=h&&(!c||!c.equals||!c.equals(h)))return}else c=h}return c};e[m]=function(a){this[b][m](a);return this};e[l]=function(){return this[b][l]()}});a._owner.inject(e);return this.base.apply(this,arguments)}}}),fa=this.PathStyle=oa.extend({_owner:D,_style:"style",_defaults:{fillColor:void 0,
strokeColor:void 0,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",miterLimit:10,dashOffset:0,dashArray:[]},_flags:{strokeWidth:v.STROKE,strokeCap:v.STROKE,strokeJoin:v.STROKE,miterLimit:v.STROKE}}),Da=this.ParagraphStyle=oa.extend({_owner:Q,_style:"paragraphStyle",_defaults:{justification:"left"},_flags:{justification:v.GEOMETRY}}),Ca=this.CharacterStyle=fa.extend({_owner:Q,_style:"style",_defaults:o.merge(fa.prototype._defaults,{fillColor:"black",fontSize:12,leading:null,font:"sans-serif"}),_flags:{fontSize:v.GEOMETRY,
leading:v.GEOMETRY,font:v.GEOMETRY}},{getLeading:function(){var a=this.base();return null!=a?a:1.2*this.getFontSize()},getFontStyle:function(){return this._fontSize+"px "+this._font}}),T=this.Color=o.extend(new function(){var a={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"]},b={},c,d=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],e={"rgb-hsb":function(a){var b=a._red,c=a._green,d=a._blue,e=Math.max(b,c,d),f=Math.min(b,c,d),f=
e-f;return new pa(0==f?0:60*(e==b?(c-d)/f+(c<d?6:0):e==c?(d-b)/f+2:(b-c)/f+4),0==e?0:f/e,e,a._alpha)},"hsb-rgb":function(a){var b=a._hue/60%6,c=a._saturation,e=a._brightness,f=Math.floor(b),b=b-f,f=d[f],c=[e,e*(1-c),e*(1-c*b),e*(1-c*(1-b))];return new W(c[f[0]],c[f[1]],c[f[2]],a._alpha)},"rgb-hsl":function(a){var b=a._red,c=a._green,d=a._blue,e=Math.max(b,c,d),f=Math.min(b,c,d),p=e-f,j=0==p,s=(e+f)/2;return new qa(j?0:60*(e==b?(c-d)/p+(c<d?6:0):e==c?(d-b)/p+2:(b-c)/p+4),j?0:0.5>s?p/(e+f):p/(2-e-f),
s,a._alpha)},"hsl-rgb":function(a){var b=a._saturation,c=a._hue/360,d=a._lightness,e;if(0==b)return new W(d,d,d,a._alpha);c=[c+1/3,c,c-1/3];b=0.5>d?d*(1+b):d+b-d*b;d=2*d-b;e=[];for(var f=0;3>f;f++){var p=c[f];0>p&&(p+=1);1<p&&(p-=1);e[f]=1>6*p?d+6*(b-d)*p:1>2*p?b:2>3*p?d+6*(b-d)*(2/3-p):d}return new W(e[0],e[1],e[2],a._alpha)},"rgb-gray":function(a){return new ra(1-(0.2989*a._red+0.587*a._green+0.114*a._blue),a._alpha)},"gray-rgb":function(a){var b=1-a._gray;return new W(b,b,b,a._alpha)},"gray-hsb":function(a){return new pa(0,
0,1-a._gray,a._alpha)},"gray-hsl":function(a){return new qa(0,0,1-a._gray,a._alpha)}},f={_readNull:!0,initialize:function(a){var d=Array.isArray(a),e=this._colorType;if("object"===typeof a&&!d)return e?T.read(arguments).convert(e):void 0!==a.red?new W(a.red,a.green,a.blue,a.alpha):void 0!==a.gray?new ra(a.gray,a.alpha):void 0!==a.lightness?new qa(a.hue,a.saturation,a.lightness,a.alpha):void 0!==a.hue?new pa(a.hue,a.saturation,a.brightness,a.alpha):new W;if("string"===typeof a){if(a.match(/^#[0-9a-f]{3,6}$/i))if(d=
a.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/),4<=d.length){for(var f=Array(3),l=0;3>l;l++){var n=d[l+1];f[l]=parseInt(1==n.length?n+n:n,16)/255}d=W.read(f)}else d=void 0;else d=a,(f=b[d])?d=f.clone():(c||(c=L.getCanvas(r.create(1,1)).getContext("2d"),c.globalCompositeOperation="copy"),c.fillStyle="rgba(0,0,0,0)",c.fillStyle=d,c.fillRect(0,0,1,1),f=c.getImageData(0,0,1,1).data,d=(b[d]=W.read([f[0]/255,f[1]/255,f[2]/255])).clone());return e?d.convert(e):d}var p=d?a:Array.prototype.slice.call(arguments);
if(e)o.each(this._components,function(a,b){var c=p[b];this["_"+a]=void 0!==c?c:null},this);else return 3<=p.length?new W(p):new ra(p)},clone:function(){for(var a=this.constructor,a=new a(a.dont),b=this._components,c=0,d=b.length;c<d;c++){var e="_"+b[c];a[e]=this[e]}return a},convert:function(a){var b;return this._colorType==a?this.clone():(b=e[this._colorType+"-"+a])?b(this):e["rgb-"+a](e[this._colorType+"-rgb"](this))},statics:{extend:function(b){if(b._colorType){var c=a[b._colorType];b._components=
c.concat(["alpha"]);o.each(c,function(a){var b="hue"===a,c=o.capitalize(a),a="_"+a;this["get"+c]=function(){return this[a]};this["set"+c]=function(c){this[a]=b?(c%360+360)%360:Math.min(Math.max(c,0),1);this._changed();return this}},b)}return this.base(b)}}};o.each(a,function(a,b){o.each(a,function(a){var c=o.capitalize(a);f["get"+c]=function(){return this.convert(b)[a]};f["set"+c]=function(c){var d=this.convert(b);d[a]=c;for(var d=d.convert(this._colorType),c=0,e=this._components.length;c<e;c++){var f=
this._components[c];this[f]=d[f]}}})});return f},{_changed:function(){this._cssString=null;for(var a=0,b=this._owners&&this._owners.length;a<b;a++)this._owners[a]._changed(v.STYLE)},_addOwner:function(a){this._owners||(this._owners=[]);this._owners.push(a)},_removeOwner:function(a){a=this._owners?this._owners.indexOf(a):-1;-1!=a&&(this._owners.splice(a,1),0==this._owners.length&&delete this._owners)},getType:function(){return this._colorType},getComponents:function(){for(var a=this._components.length,
b=Array(a),c=0;c<a;c++)b[c]=this["_"+this._components[c]];return b},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(a){this._alpha=null==a?null:Math.min(Math.max(a,0),1);this._changed();return this},hasAlpha:function(){return null!=this._alpha},equals:function(a){if(a&&a._colorType===this._colorType){for(var b=0,c=this._components.length;b<c;b++){var d="_"+this._components[b];if(this[d]!==a[d])return!1}return!0}return!1},toString:function(){for(var a=[],b=o.formatNumber,
c=0,d=this._components.length;c<d;c++){var e=this._components[c],f=this["_"+e];"alpha"===e&&null==f&&(f=1);a.push(e+": "+b(f))}return"{ "+a.join(", ")+" }"},toCssString:function(){if(!this._cssString){var a=this.convert("rgb"),b=a.getAlpha();this._cssString="rgba("+[Math.round(255*a._red),Math.round(255*a._green),Math.round(255*a._blue),null!=b?b:1].join(", ")+")"}return this._cssString},getCanvasStyle:function(){return this.toCssString()}}),ra=this.GrayColor=T.extend({_colorType:"gray"}),W=this.RgbColor=
this.RGBColor=T.extend({_colorType:"rgb"}),pa=this.HsbColor=this.HSBColor=T.extend({_colorType:"hsb"}),qa=this.HslColor=this.HSLColor=T.extend({_colorType:"hsl"}),Fa=this.GradientColor=T.extend({initialize:function(a,b,c,d){this.gradient=a||new ya;this.gradient._addOwner(this);this.setOrigin(b);this.setDestination(c);d&&this.setHilite(d)},clone:function(){return new Fa(this.gradient,this._origin,this._destination,this._hilite)},getOrigin:function(){return this._origin},setOrigin:function(a){this._origin=
a=j.read(arguments).clone();this._destination&&(this._radius=this._destination.getDistance(this._origin));this._changed();return this},getDestination:function(){return this._destination},setDestination:function(a){this._destination=a=j.read(arguments).clone();this._radius=this._destination.getDistance(this._origin);this._changed();return this},getHilite:function(){return this._hilite},setHilite:function(a){var a=j.read(arguments).clone(),b=a.subtract(this._origin);this._hilite=b.getLength()>this._radius?
this._origin.add(b.normalize(this._radius-0.1)):a;this._changed();return this},getCanvasStyle:function(a){if("linear"===this.gradient.type)a=a.createLinearGradient(this._origin.x,this._origin.y,this._destination.x,this._destination.y);else var b=this._hilite||this._origin,a=a.createRadialGradient(b.x,b.y,0,this._origin.x,this._origin.y,this._radius);for(var b=0,c=this.gradient._stops.length;b<c;b++){var d=this.gradient._stops[b];a.addColorStop(d._rampPoint,d._color.toCssString())}return a},equals:function(a){return a==
this||a&&a._colorType===this._colorType&&this.gradient.equals(a.gradient)&&this._origin.equals(a._origin)&&this._destination.equals(a._destination)},transform:function(a){a._transformPoint(this._origin,this._origin,!0);a._transformPoint(this._destination,this._destination,!0);this._hilite&&a._transformPoint(this._hilite,this._hilite,!0);this._radius=this._destination.getDistance(this._origin)}}),ya=this.Gradient=o.extend({initialize:function(a,b){this.setStops(a||["white","black"]);this.type=b||"linear"},
_changed:function(){for(var a=0,b=this._owners&&this._owners.length;a<b;a++)this._owners[a]._changed()},_addOwner:function(a){this._owners||(this._owners=[]);this._owners.push(a)},_removeOwner:function(a){a=this._owners?this._owners.indexOf(a):-1;-1!=a&&(this._owners.splice(a,1),0==this._owners.length&&delete this._owners)},clone:function(){for(var a=[],b=0,c=this._stops.length;b<c;b++)a[b]=this._stops[b].clone();return new ya(a,this.type)},getStops:function(){return this._stops},setStops:function(a){if(this.stops)for(var b=
0,c=this._stops.length;b<c;b++)this._stops[b]._removeOwner(this);if(2>a.length)throw Error("Gradient stop list needs to contain at least two stops.");this._stops=sa.readAll(a);b=0;for(c=this._stops.length;b<c;b++)a=this._stops[b],a._addOwner(this),a._defaultRamp&&a.setRampPoint(b/(c-1));this._changed()},equals:function(a){if(a.type!=this.type)return!1;if(this._stops.length==a._stops.length){for(var b=0,c=this._stops.length;b<c;b++)if(!this._stops[b].equals(a._stops[b]))return!1;return!0}return!1}}),
sa=this.GradientStop=o.extend({initialize:function(a,b){void 0===b&&Array.isArray(a)?(this.setColor(a[0]),this.setRampPoint(a[1])):a.color?(this.setColor(a.color),this.setRampPoint(a.rampPoint)):(this.setColor(a),this.setRampPoint(b))},clone:function(){return new sa(this._color.clone(),this._rampPoint)},_changed:function(){for(var a=0,b=this._owners&&this._owners.length;a<b;a++)this._owners[a]._changed(v.STYLE)},_addOwner:function(a){this._owners||(this._owners=[]);this._owners.push(a)},_removeOwner:function(a){a=
this._owners?this._owners.indexOf(a):-1;-1!=a&&(this._owners.splice(a,1),0==this._owners.length&&delete this._owners)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(a){this._defaultRamp=null==a;this._rampPoint=a||0;this._changed()},getColor:function(){return this._color},setColor:function(a){this._color&&this._color._removeOwner(this);this._color=T.read(arguments);this._color._addOwner(this);this._changed()},equals:function(a){return a==this||a instanceof sa&&this._color.equals(a._color)&&
this._rampPoint==a._rampPoint}}),N={getBounds:function(a,b){var c=a.getBoundingClientRect(),d=a.ownerDocument,e=d.body,f=d.documentElement,g=c.left-(f.clientLeft||e.clientLeft||0),h=c.top-(f.clientTop||e.clientTop||0);b||(d=N.getViewport(d),g+=d.pageXOffset||f.scrollLeft||e.scrollLeft,h+=d.pageYOffset||f.scrollTop||e.scrollTop);return new t(g,h,c.width,c.height)},getOffset:function(a,b){return this.getBounds(a,b).getPoint()},getSize:function(a){return this.getBounds(a,!0).getSize()},isInvisible:function(a){return this.getSize(a).equals([0,
0])},isVisible:function(a){return!this.isInvisible(a)&&this.getViewportBounds(a).intersects(this.getBounds(a,!0))},getViewport:function(a){return a.defaultView||a.parentWindow},getViewportBounds:function(a){var b=a.ownerDocument,a=this.getViewport(b),b=b.getElementsByTagName("CSS1Compat"===b.compatMode?"html":"body")[0];return t.create(0,0,a.innerWidth||b.clientWidth,a.innerHeight||b.clientHeight)},getComputedStyle:function(a,b){if(a.currentStyle)return a.currentStyle[o.camelize(b)];var c=this.getViewport(a.ownerDocument).getComputedStyle(a,
null);return c?c.getPropertyValue(o.hyphenate(b)):null}},F={add:function(a,b){for(var c in b){var d=b[c];a.addEventListener?a.addEventListener(c,d,!1):a.attachEvent&&a.attachEvent("on"+c,d.bound=function(){d.call(a,window.event)})}},remove:function(a,b){for(var c in b){var d=b[c];a.removeEventListener?a.removeEventListener(c,d,!1):a.detachEvent&&a.detachEvent("on"+c,d.bound)}},getPoint:function(a){a=a.targetTouches?a.targetTouches.length?a.targetTouches[0]:a.changedTouches[0]:a;return j.create(a.pageX||
a.clientX+document.documentElement.scrollLeft,a.pageY||a.clientY+document.documentElement.scrollTop)},getTarget:function(a){return a.target||a.srcElement},getOffset:function(a,b){return F.getPoint(a).subtract(N.getOffset(b||F.getTarget(a)))},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},stop:function(a){F.stopPropagation(a);F.preventDefault(a)}};F.requestAnimationFrame=new function(){var a=
window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;a&&a(function(b){void 0==b&&(a=null)});var b=[],c=!0,d;F.add(window,{focus:function(){c=!0},blur:function(){c=!1}});return function(e,f){if(a)return a(e,f);b.push([e,f]);d||(d=window.setInterval(function(){for(var a=b.length-1;0<=a;a--){var d=b[a],e=d[0],d=d[1];if(!d||("true"==Y.getAttribute(d,"keepalive")||c)&&N.isVisible(d))b.splice(a,1),
e(Date.now())}},1E3/60))}};var C=this.View=o.extend(ia,{_events:{onFrame:{install:function(){var a=this,b=!1,c,d=0,e=0;this._onFrameCallback=function(f,g){b=!1;if(a._onFrameCallback){paper=a._scope;g||(b=!0,F.requestAnimationFrame(a._onFrameCallback,a._element));var h=Date.now()/1E3,i=c?h-c:0;a.fire("frame",o.merge({delta:i,time:d+=i,count:e++}));c=h;a._stats&&a._stats.update();a.draw(!0)}};b||this._onFrameCallback()},uninstall:function(){delete this._onFrameCallback}},onResize:{}},initialize:function(a){this._scope=
paper;this._project=paper.project;this._element=a;var b;this._id=a.getAttribute("id");null==this._id&&a.setAttribute("id",this._id="view-"+C._id++);F.add(a,this._handlers);if(Y.hasAttribute(a,"resize")){var c=N.getOffset(a,!0),d=this;b=N.getViewportBounds(a).getSize().subtract(c);a.width=b.width;a.height=b.height;F.add(window,{resize:function(){N.isInvisible(a)||(c=N.getOffset(a,true));d.setViewSize(N.getViewportBounds(a).getSize().subtract(c))}})}else b=N.isInvisible(a)?r.create(parseInt(a.getAttribute("width")),
parseInt(a.getAttribute("height"))):N.getSize(a);if(Y.hasAttribute(a,"stats")){this._stats=new Stats;var e=this._stats.domElement,f=e.style,c=N.getOffset(a);f.position="absolute";f.left=c.x+"px";f.top=c.y+"px";document.body.appendChild(e)}C._views.push(this);C._viewsById[this._id]=this;this._viewSize=ba.create(this,"setViewSize",b.width,b.height);this._matrix=new I;this._zoom=1;C._focused||(C._focused=this)},remove:function(){if(!this._project)return!1;C._focused==this&&(C._focused=null);C._views.splice(C._views.indexOf(this),
1);delete C._viewsById[this._id];this._project.view==this&&(this._project.view=null);F.remove(this._element,this._handlers);this._element=this._project=null;this.detach("frame");return!0},_redraw:function(){this._redrawNeeded=!0;this._onFrameCallback?this._onFrameCallback(0,!0):this.draw()},_transform:function(a){this._matrix.preConcatenate(a);this._inverse=this._bounds=null;this._redraw()},getElement:function(){return this._element},getViewSize:function(){return this._viewSize},setViewSize:function(a){var a=
r.read(arguments),b=a.subtract(this._viewSize);b.isZero()||(this._element.width=a.width,this._element.height=a.height,this._viewSize.set(a.width,a.height,!0),this._bounds=null,this._redrawNeeded=!0,this.fire("resize",{size:a,delta:b}),this._redraw())},getBounds:function(){this._bounds||(this._bounds=this._getInverse()._transformBounds(new t(new j,this._viewSize)));return this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(a){this.scrollBy(j.read(arguments).subtract(this.getCenter()))},
getZoom:function(){return this._zoom},setZoom:function(a){this._transform((new I).scale(a/this._zoom,this.getCenter()));this._zoom=a},isVisible:function(){return N.isVisible(this._element)},scrollBy:function(a){this._transform((new I).translate(j.read(arguments).negate()))},projectToView:function(a){return this._matrix._transformPoint(j.read(arguments))},viewToProject:function(a){return this._getInverse()._transformPoint(j.read(arguments))},_getInverse:function(){this._inverse||(this._inverse=this._matrix.createInverse());
return this._inverse}},{statics:{_views:[],_viewsById:{},_id:0,create:function(a){"string"===typeof a&&(a=document.getElementById(a));return new Ga(a)}}},new function(){function a(){if(!C._focused||!C._focused.isVisible())for(var a=0,b=C._views.length;a<b;a++){var c=C._views[a];if(c&&c.isVisible()){C._focused=h=c;break}}}function b(a){var b=C._focused=C._viewsById[F.getTarget(a).getAttribute("id")];g=b.viewToProject(F.getOffset(a,b._element));i=!0;b._onMouseDown&&b._onMouseDown(a,g);(f=b._scope.tool)&&
f._onHandleEvent("mousedown",g,a);b.draw(!0)}function c(b){var c;i||((c=C._viewsById[F.getTarget(b).getAttribute("id")])?C._focused=h=c:h&&h==C._focused&&(C._focused=null,a()));if(c=c||C._focused){var d=b&&c.viewToProject(F.getOffset(b,c._element));c._onMouseMove&&c._onMouseMove(b,d);if(f=c._scope.tool){var e=!(f.onMouseDrag||!f.onMouseMove);i&&!e?(g=d||g)&&f._onHandleEvent("mousedrag",g,b)&&F.stop(b):(!i||e)&&f._onHandleEvent("mousemove",d,b)&&F.stop(b)}c.draw(!0)}}function d(a){var b=C._focused;
if(b&&i){var c=b.viewToProject(F.getOffset(a,b._element));g=null;i=!1;b._onMouseUp&&b._onMouseUp(a,c);f&&f._onHandleEvent("mouseup",c,a)&&F.stop(a);b.draw(!0)}}function e(a){i&&F.stop(a)}var f,g,h,i=!1;F.add(document,{mousemove:c,mouseup:d,touchmove:c,touchend:d,selectstart:e,scroll:a});F.add(window,{load:a});return{_handlers:{mousedown:b,touchstart:b,selectstart:e},statics:{updateFocus:a}}}),Ga=C.extend({initialize:function(a){if(!(a instanceof HTMLCanvasElement)){var b=r.read(arguments,1);b.isZero()&&
(b=r.create(1024,768));a=L.getCanvas(b)}this._context=a.getContext("2d");this._eventCounters={};this.base(a)},draw:function(a){if(a&&!this._redrawNeeded)return!1;var a=this._context,b=this._viewSize;a.clearRect(0,0,b._width+1,b._height+1);this._project.draw(a,this._matrix);this._redrawNeeded=!1;return!0}},new function(){function a(a,b,c,d,e,f){for(var g=d,h,i=!1;g&&(!g.responds(a)||!(h||(h=new Ha(a,b,c,d,e?c.subtract(e):null)),(i=g.fire(a,h)||i)&&(!f||h._stopped)));)g=g.getParent();return i}function b(b,
d,e,f,g){if(b._eventCounters[d]&&(b=(b=b._project.hitTest(f,c))&&b.item))return"mousemove"==d&&b!=h&&(g=f),("mousemove"!=d||!i)&&a(d,e,f,b,g),b}var c={fill:!0,stroke:!0,tolerance:0},d,e,f,g,h,i,m,l;return{_onMouseDown:function(a,c){var h=b(this,"mousedown",a,c);m=g==h&&300>Date.now()-l;g=h;d=e=f=c;i=g&&g.responds("mousedrag")},_onMouseUp:function(c,j){var o=b(this,"mouseup",c,j);i&&(e&&!e.equals(j)&&a("mousedrag",c,j,g,e),o!=g&&(f=j,a("mousemove",c,j,o,f)));o==g&&(l=Date.now(),a(m?"doubleclick":"click",
c,d,h),m=!1);g=null;i=!1},_onMouseMove:function(c,d){g&&a("mousedrag",c,d,g,e);var i=b(this,"mousemove",c,d,f);e=f=d;i!=h&&(a("mouseleave",c,d,h),h=i,a("mouseenter",c,d,i))}}}),Q=this.Event=o.extend({initialize:function(a){this.event=a},preventDefault:function(){this._prevented=!0;F.preventDefault(this.event);return this},stopPropagation:function(){this._stopped=!0;F.stopPropagation(this.event);return this},stop:function(){return this.stopPropagation().preventDefault()},getModifiers:function(){return Ia.modifiers}}),
Ja=this.KeyEvent=Q.extend({initialize:function(a,b,c,d){this.base(d);this.type=a?"keydown":"keyup";this.key=b;this.character=c},toString:function(){return"{ type: "+this.type+", key: "+this.key+", character: "+this.character+", modifiers: "+this.getModifiers()+" }"}}),Ia=this.Key=new function(){function a(a,c,d,f){var d=String.fromCharCode(d),c=b[c]||d.toLowerCase(),l=a?"keydown":"keyup",n=C._focused,j=n&&n.isVisible()&&n._scope,j=j&&j.tool;e[c]=a;j&&j.responds(l)&&(j.fire(l,new Ja(a,c,d,f)),n&&n.draw(!0))}
var b={8:"backspace",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},c=o.merge({shift:!1,control:!1,option:!1,command:!1,capsLock:!1}),d={},e={},f;F.add(document,{keydown:function(e){var h=e.which||e.keyCode,i=b[h];if(i){if((i=o.camelize(i))in c)c[i]=!0;d[h]=0;a(!0,h,null,e)}else f=h},keypress:function(b){if(null!=f){var c=b.which||b.keyCode;
d[f]=c;a(!0,f,c,b);f=null}},keyup:function(e){var f=e.which||e.keyCode,i=b[f],m;if(i&&(m=o.camelize(i))in c)c[m]=!1;null!=d[f]&&(a(!1,f,d[f],e),delete d[f])}});return{modifiers:c,isDown:function(a){return!!e[a]}}},Ha=this.MouseEvent=Q.extend({initialize:function(a,b,c,d,e){this.base(b);this.type=a;this.point=c;this.target=d;this.delta=e},toString:function(){return"{ type: "+this.type+", point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+
" }"}}),da=this.ToolEvent=Q.extend({initialize:function(a,b,c){this.tool=a;this.type=b;this.event=c},_choosePoint:function(a,b){return a?a:b?b.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(a){this._point=a},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(a){this._lastPoint=a},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(a){this._downPoint=
a},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this.middlePoint},setMiddlePoint:function(a){this._middlePoint=a},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(a){this._delta=a},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(a){this.tool[/^mouse(down|up)$/.test(this.type)?
"downCount":"count"]=a},getItem:function(){if(!this._item){var a=this.tool._scope.project.hitTest(this.getPoint());if(a){for(var a=a.item,b=a._parent;b instanceof la&&!(b instanceof ca)||b instanceof wa;)a=b,b=b._parent;this._item=a}}return this._item},setItem:function(a){this._item=a},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),R=this.Tool=ua.extend(ia,{_list:"tools",_reference:"_tool",_events:"onEditOptions onSelect onDeselect onReselect onMouseDown onMouseUp onMouseDrag onMouseMove onKeyDown onKeyUp".split(" "),
initialize:function(){this.base();this._firstMove=!0;this._downCount=this._count=0},getMinDistance:function(){return this._minDistance},setMinDistance:function(a){this._minDistance=a;null!=this._minDistance&&(null!=this._maxDistance&&this._minDistance>this._maxDistance)&&(this._maxDistance=this._minDistance)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(a){this._maxDistance=a;null!=this._minDistance&&(null!=this._maxDistance&&this._maxDistance<this._minDistance)&&(this._minDistance=
a)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(a){this._maxDistance=this._minDistance=a},_updateEvent:function(a,b,c,d,e,f,g){if(!e){if(null!=c||null!=d){var h=null!=c?c:0,c=b.subtract(this._point),i=c.getLength();if(i<h)return!1;d=null!=d?d:0;if(0!=d)if(i>d)b=this._point.add(c.normalize(d));else if(g)return!1}if(f&&b.equals(this._point))return!1}this._lastPoint=e&&"mousemove"==a?b:this._point;this._point=b;switch(a){case "mousedown":this._lastPoint=
this._downPoint;this._downPoint=this._point;this._downCount++;break;case "mouseup":this._lastPoint=this._downPoint}this._count=e?0:this._count+1;return!0},_onHandleEvent:function(a,b,c){paper=this._scope;var d=R._removeSets;if(d){"mouseup"===a&&(d.mousedrag=null);var e=d[a];if(e){for(var f in e){var g=e[f],h;for(h in d){var i=d[h];i&&(i!=e&&i[g._id])&&delete i[g._id]}g.remove()}d[a]=null}}d=!1;switch(a){case "mousedown":this._updateEvent(a,b,null,null,!0,!1,!1);this.responds(a)&&(d=this.fire(a,new da(this,
a,c)));break;case "mousedrag":for(f=e=!1;this._updateEvent(a,b,this.minDistance,this.maxDistance,!1,e,f);)this.responds(a)&&(d=this.fire(a,new da(this,a,c))),f=e=!0;break;case "mouseup":if((this._point.x!=b.x||this._point.y!=b.y)&&this._updateEvent("mousedrag",b,this.minDistance,this.maxDistance,!1,!1,!1))this.responds("mousedrag")&&(d=this.fire("mousedrag",new da(this,a,c)));this._updateEvent(a,b,null,this.maxDistance,!1,!1,!1);this.responds(a)&&(d=this.fire(a,new da(this,a,c)));this._updateEvent(a,
b,null,null,!0,!1,!1);this._firstMove=!0;break;case "mousemove":for(;this._updateEvent(a,b,this.minDistance,this.maxDistance,this._firstMove,!0,!1);)this.responds(a)&&(d=this.fire(a,new da(this,a,c))),this._firstMove=!1}return d}}),L={canvases:[],getCanvas:function(a){if(this.canvases.length){var b=this.canvases.pop();b.width!=a.width||b.height!=a.height?(b.width=a.width,b.height=a.height):b.getContext("2d").clearRect(0,0,a.width+1,a.height+1)}else b=document.createElement("canvas"),b.width=a.width,
b.height=a.height;return b},returnCanvas:function(a){this.canvases.push(a)}},E=new function(){var a=[[0.5773502691896257],[0,0.7745966692414834],[0.33998104358485626,0.8611363115940526],[0,0.5384693101056831,0.906179845938664],[0.2386191860831969,0.6612093864662645,0.932469514203152],[0,0.4058451513773972,0.7415311855993945,0.9491079123427585],[0.1834346424956498,0.525532409916329,0.7966664774136267,0.9602898564975363],[0,0.3242534234038089,0.6133714327005904,0.8360311073266358,0.9681602395076261],
[0.14887433898163122,0.4333953941292472,0.6794095682990244,0.8650633666889845,0.9739065285171717],[0,0.26954315595234496,0.5190961292068118,0.7301520055740494,0.8870625997680953,0.978228658146057],[0.1252334085114689,0.3678314989981802,0.5873179542866175,0.7699026741943047,0.9041172563704749,0.9815606342467192],[0,0.2304583159551348,0.44849275103644687,0.6423493394403402,0.8015780907333099,0.9175983992229779,0.9841830547185881],[0.10805494870734367,0.31911236892788974,0.5152486363581541,0.6872929048116855,
0.827201315069765,0.9284348836635735,0.9862838086968123],[0,0.20119409399743451,0.3941513470775634,0.5709721726085388,0.7244177313601701,0.8482065834104272,0.937273392400706,0.9879925180204854],[0.09501250983763744,0.2816035507792589,0.45801677765722737,0.6178762444026438,0.755404408355003,0.8656312023878318,0.9445750230732326,0.9894009349916499]],b=[[1],[0.8888888888888888,0.5555555555555556],[0.6521451548625461,0.34785484513745385],[0.5688888888888889,0.47862867049936647,0.23692688505618908],[0.46791393457269104,
0.3607615730481386,0.17132449237917036],[0.4179591836734694,0.3818300505051189,0.27970539148927664,0.1294849661688697],[0.362683783378362,0.31370664587788727,0.22238103445337448,0.10122853629037626],[0.3302393550012598,0.31234707704000286,0.26061069640293544,0.1806481606948574,0.08127438836157441],[0.29552422471475287,0.26926671930999635,0.21908636251598204,0.1494513491505806,0.06667134430868814],[0.2729250867779006,0.26280454451024665,0.23319376459199048,0.18629021092773426,0.1255803694649046,0.05566856711617366],
[0.24914704581340277,0.2334925365383548,0.20316742672306592,0.16007832854334622,0.10693932599531843,0.04717533638651183],[0.2325515532308739,0.22628318026289723,0.2078160475368885,0.17814598076194574,0.13887351021978725,0.09212149983772845,0.04048400476531588],[0.2152638534631578,0.2051984637212956,0.18553839747793782,0.15720316715819355,0.12151857068790319,0.08015808715976021,0.03511946033175186],[0.2025782419255613,0.19843148532711158,0.1861610000155622,0.16626920581699392,0.13957067792615432,0.10715922046717194,
0.07036604748810812,0.03075324199611727],[0.1894506104550685,0.18260341504492358,0.16915651939500254,0.14959598881657674,0.12462897125553388,0.09515851168249279,0.062253523938647894,0.027152459411754096]],c=Math.abs,d=Math.sqrt,e=Math.cos,f=Math.PI;return{TOLERANCE:1E-5,EPSILON:1E-11,integrate:function(c,d,e,f){for(var l=a[f-2],n=b[f-2],e=0.5*(e-d),d=e+d,j=0,o=f+1>>1,f=f&1?n[j++]*c(d):0;j<o;)var s=e*l[j],f=f+n[j++]*(c(d+s)+c(d-s));return e*f},findRoot:function(a,b,d,e,f,j,p){for(var o=0;o<j;o++){var s=
a(d),u=s/b(d);if(c(u)<p)return d;u=d-u;0<s?(f=d,d=u<=e?0.5*(e+f):u):(e=d,d=u>=f?0.5*(e+f):u)}},solveQuadratic:function(a,b,e,f,l){if(c(a)<l)return c(b)>=l?(f[0]=-e/b,1):c(e)<l?-1:0;var j=b*b-4*a*e;if(0>j)return 0;j=d(j);0>b&&(j=-j);j=-0.5*(b+j);b=0;c(j)>=l&&(f[b++]=e/j);c(a)>=l&&(f[b++]=j/a);return b},solveCubic:function(a,b,i,j,l,n){if(c(a)<n)return E.solveQuadratic(b,i,j,l,n);var b=b/a,i=i/a,p=(b*b-3*i)/9,a=(2*b*b*b-9*b*i+27*(j/a))/54,i=p*p*p,j=a*a,b=b/3;if(j<i)return n=Math.acos(a/d(i)),p=-2*d(p),
l[0]=p*e(n/3)-b,l[1]=p*e((n+2*f)/3)-b,l[2]=p*e((n-2*f)/3)-b,3;i=-Math.pow(c(a)+d(j-i),1/3);0>a&&(i=-i);p=c(i)<n?0:p/i;l[0]=i+p-b;return 1}}},Aa={process:function(a,b,c,d,e){function f(a,b,c,d){d-=0.2989*a+0.587*b+0.114*c;r=a+d;t=b+d;v=c+d;d=0.2989*r+0.587*t+0.114*v;b=l(r,t,v);a=n(r,t,v);0>b&&(b=d-b,r=d+(r-d)*d/b,t=d+(t-d)*d/b,v=d+(v-d)*d/b);255<a&&(b=255-d,a-=d,r=d+(r-d)*b/a,t=d+(t-d)*b/a,v=d+(v-d)*b/a)}function g(a,b,c,d){var e=[a,b,c],f=n(a,b,c),c=l(a,b,c),c=c==a?0:c==b?1:2,f=f==a?0:f==b?1:2,a=
0==l(c,f)?1==n(c,f)?2:1:0;e[f]>e[c]?(e[a]=(e[a]-e[c])*d/(e[f]-e[c]),e[f]=d):e[a]=e[f]=0;e[c]=0;r=e[0];t=e[1];v=e[2]}var h=b.canvas,i=c.getImageData(e.x,e.y,h.width,h.height),j=i.data,b=b.getImageData(0,0,h.width,h.height).data,l=Math.min,n=Math.max,p=Math.abs,o,s,u,y,w,q,r,t,v,J={multiply:function(){r=y*o/255;t=w*s/255;v=q*u/255},screen:function(){r=255-(255-y)*(255-o)/255;t=255-(255-w)*(255-s)/255;v=255-(255-q)*(255-u)/255},overlay:function(){r=128>y?2*y*o/255:255-2*(255-y)*(255-o)/255;t=128>w?2*
w*s/255:255-2*(255-w)*(255-s)/255;v=128>q?2*q*u/255:255-2*(255-q)*(255-u)/255},"soft-light":function(){var a=o*y/255;r=a+y*(255-(255-y)*(255-o)/255-a)/255;a=s*w/255;t=a+w*(255-(255-w)*(255-s)/255-a)/255;a=u*q/255;v=a+q*(255-(255-q)*(255-u)/255-a)/255},"hard-light":function(){r=128>o?2*o*y/255:255-2*(255-o)*(255-y)/255;t=128>s?2*s*w/255:255-2*(255-s)*(255-w)/255;v=128>u?2*u*q/255:255-2*(255-u)*(255-q)/255},"color-dodge":function(){r=255==o?o:l(255,255*y/(255-o));t=255==s?s:l(255,255*w/(255-s));v=255==
u?u:l(255,255*q/(255-u))},"color-burn":function(){r=0==o?0:n(255-255*(255-y)/o,0);t=0==s?0:n(255-255*(255-w)/s,0);v=0==u?0:n(255-255*(255-q)/u,0)},darken:function(){r=y<o?y:o;t=w<s?w:s;v=q<u?q:u},lighten:function(){r=y>o?y:o;t=w>s?w:s;v=q>u?q:u},difference:function(){r=y-o;0>r&&(r=-r);t=w-s;0>t&&(t=-t);v=q-u;0>v&&(v=-v)},exclusion:function(){r=y+o*(255-y-y)/255;t=w+s*(255-w-w)/255;v=q+u*(255-q-q)/255},hue:function(){g(o,s,u,n(y,w,q)-l(y,w,q));f(r,t,v,0.2989*y+0.587*w+0.114*q)},saturation:function(){g(y,
w,q,n(o,s,u)-l(o,s,u));f(r,t,v,0.2989*y+0.587*w+0.114*q)},luminosity:function(){f(y,w,q,0.2989*o+0.587*s+0.114*u)},color:function(){f(o,s,u,0.2989*y+0.587*w+0.114*q)},add:function(){r=l(y+o,255);t=l(w+s,255);v=l(q+u,255)},subtract:function(){r=n(y-o,0);t=n(w-s,0);v=n(q-u,0)},average:function(){r=(y+o)/2;t=(w+s)/2;v=(q+u)/2},negation:function(){r=255-p(255-o-y);t=255-p(255-s-w);v=255-p(255-u-q)}}[a];if(J){for(var H=0,C=j.length;H<C;H+=4){o=b[H];y=j[H];s=b[H+1];w=j[H+1];u=b[H+2];q=j[H+2];a=b[H+3];h=
j[H+3];J();var F=a*d/255,I=1-F;j[H]=F*r+I*y;j[H+1]=F*t+I*w;j[H+2]=F*v+I*q;j[H+3]=a*d+I*h}c.putImageData(i,e.x,e.y)}}},Y=this.PaperScript=new function(){function a(a){a=a[0];return"num"!=a&&"string"!=a}function b(b,c,d){if(i[b]&&a(c))return["call",["name","$eval"],[c,["string",b],d]]}function c(c){var d=h.parse(c),c=h.ast_walker(),e=c.walk,d=c.with_walkers({binary:function(a,c,d){return b(a,c=e(c),d=e(d))||[this[0],a,c,d]},assign:function(a,c,d){var f=b(a,c=e(c),d=e(d));return f?[this[0],!0,c,f]:[this[0],
a,c,d]},"unary-prefix":function(b,c){if(m[b]&&a(c))return["call",["name","$sign"],[["string",b],e(c)]]}},function(){return e(d)});return h.gen_code(d,{beautify:!0})}function d(a,b){paper=b;var d=b.project.view,e;with(b)(function(){e=eval(c(a));/on(?:Key|Mouse)(?:Up|Down|Move|Drag)/.test(a)&&o.each(R.prototype._events,function(a){var c=eval(a);c&&(b.getTool()[a]=c)});d&&(d.setOnResize(void 0),d.fire("resize",{size:d.size,delta:new j}),d.setOnFrame(void 0),d.draw())}).call(b);return e}function e(a,
b){var c=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");c.open("GET",a,!0);c.overrideMimeType&&c.overrideMimeType("text/plain");c.onreadystatechange=function(){if(4===c.readyState)return d(c.responseText,b)};return c.send(null)}function f(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;b<c;b++){var f=a[b];if(/^text\/(?:x-|)paperscript$/.test(f.type)&&!f.getAttribute("data-paper-loaded")){var g=new X(f);g.setup(Y.getAttribute(f,"canvas"));f.src?e(f.src,g):d(f.innerHTML,
g);f.setAttribute("data-paper-loaded",!0)}}}function g(a){a+="Attribute";return function(b,c){return b[a](c)||b[a]("data-paper-"+c)}}var h=new function(){function a(b,c,d){for(var e=[],f=0;f<b.length;++f)e.push(c.call(d,b[f],f));return e}function b(a){var c=0,d=0,a=a.replace(/[\\\b\f\n\r\t\x22\x27]/g,function(a){switch(a){case "\\":return"\\\\";case "\b":return"\\b";case "\f":return"\\f";case "\n":return"\\n";case "\r":return"\\r";case "\t":return"\\t";case '"':return++c,'"';case "'":return++d,"'"}return a});
return c>d?"'"+a.replace(/\x27/g,"\\'")+"'":'"'+a.replace(/\x22/g,'\\"')+'"'}function c(a){return!a||"block"==a[0]&&(!a[1]||0==a[1].length)}function d(){function b(a){if(null==a)return null;try{j.push(a);var c=a[0],d=i[c];if(d){var e=d.apply(a,a.slice(1));if(null!=e)return e}d=h[c];return d.apply(a,a.slice(1))}finally{j.pop()}}function c(d){var e=[this[0]];null!=d&&e.push(a(d,b));return e}function f(c){return[this[0],a(c,function(a){var c=[a[0]];1<a.length&&(c[1]=b(a[1]));return c})]}var h={string:function(a){return[this[0],
a]},num:function(a){return[this[0],a]},name:function(a){return[this[0],a]},toplevel:function(c){return[this[0],a(c,b)]},block:c,splice:c,"var":f,"const":f,"try":function(c,d,e){return[this[0],a(c,b),null!=d?[d[0],a(d[1],b)]:null,null!=e?a(e,b):null]},"throw":function(a){return[this[0],b(a)]},"new":function(c,d){return[this[0],b(c),a(d,b)]},"switch":function(c,d){return[this[0],b(c),a(d,function(c){return[c[0]?b(c[0]):null,a(c[1],b)]})]},"break":function(a){return[this[0],a]},"continue":function(a){return[this[0],
a]},conditional:function(a,c,d){return[this[0],b(a),b(c),b(d)]},assign:function(a,c,d){return[this[0],a,b(c),b(d)]},dot:function(a){return[this[0],b(a)].concat(g(arguments,1))},call:function(c,d){return[this[0],b(c),a(d,b)]},"function":function(c,d,e){return[this[0],c,d.slice(),a(e,b)]},defun:function(c,d,e){return[this[0],c,d.slice(),a(e,b)]},"if":function(a,c,d){return[this[0],b(a),b(c),b(d)]},"for":function(a,c,d,e){return[this[0],b(a),b(c),b(d),b(e)]},"for-in":function(a,c,d,e){return[this[0],
b(a),b(c),b(d),b(e)]},"while":function(a,c){return[this[0],b(a),b(c)]},"do":function(a,c){return[this[0],b(a),b(c)]},"return":function(a){return[this[0],b(a)]},binary:function(a,c,d){return[this[0],a,b(c),b(d)]},"unary-prefix":function(a,c){return[this[0],a,b(c)]},"unary-postfix":function(a,c){return[this[0],a,b(c)]},sub:function(a,c){return[this[0],b(a),b(c)]},object:function(c){return[this[0],a(c,function(a){return 2==a.length?[a[0],b(a[1])]:[a[0],b(a[1]),a[2]]})]},regexp:function(a,b){return[this[0],
a,b]},array:function(c){return[this[0],a(c,b)]},stat:function(a){return[this[0],b(a)]},seq:function(){return[this[0]].concat(a(g(arguments),b))},label:function(a,c){return[this[0],a,b(c)]},"with":function(a,c){return[this[0],b(a),b(c)]},atom:function(a){return[this[0],a]}},i={},j=[];return{walk:b,with_walkers:function(a,b){var c={},d;for(d in a)e(a,d)&&(c[d]=i[d],i[d]=a[d]);var f=b();for(d in c)e(c,d)&&(c[d]?i[d]=c[d]:delete i[d]);return f},parent:function(){return j[j.length-2]},stack:function(){return j}}}
function e(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function f(a,b){for(var c=b.length;0<=--c;)if(b[c]===a)return!0;return!1}function g(a,b){return Array.prototype.slice.call(a,b||0)}function h(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=!0;return b}function i(a){a instanceof Function&&(a=a());for(var b=1,c=arguments.length;0<--c;++b)arguments[b]();return a}function j(a){var b=g(arguments,1);return function(){return a.apply(this,b.concat(g(arguments)))}}function m(a,b,c){this.name=a;this.start=
b;this.end=c}function o(a){function b(a){if(a)return g();for(;e(O,C());)y();z.tokline=z.line;z.tokcol=z.col;z.tokpos=z.pos;a=C();if(!a)return u("eof");if(t(a))return m();if('"'==a||"'"==a)return c("Unterminated string constant",function(){for(var a=y(),b="";;){var c=y(!0);if("\\"==c)c=l();else if(c==a)break;b+=c}return u("string",b)});if(e(T,a))return u("punc",y());if("."==a)return y(),t(C())?m("."):u("punc",".");if("/"==a)return d();if(e(E,a))return f();if("\\"==a||"$"==a||"_"==a||v(a))return a=
p(r),e(J,a)?e(N,a)?u("operator",a):e(I,a)?u("atom",a):u("keyword",a):u("name",a);n("Unexpected character '"+a+"'")}function c(a,b){try{return b()}catch(d){if(d===S)n(a);else throw d;}}function d(){y();var a=z.regex_allowed;switch(C()){case "/":return z.comments_before.push(i()),z.regex_allowed=a,b();case "*":return z.comments_before.push(h()),z.regex_allowed=a,b()}return z.regex_allowed?g():f("/")}function f(a){function b(a){if(!C())return a;var c=a+C();return e(N,c)?(y(),b(c)):a}return u("operator",
b(a||y()))}function g(){return c("Unterminated regular expression",function(){for(var a=!1,b="",c,d=!1;c=y(!0);)if(a)b+="\\"+c,a=!1;else if("["==c)d=!0,b+=c;else if("]"==c&&d)d=!1,b+=c;else{if("/"==c&&!d)break;"\\"==c?a=!0:b+=c}a=p(function(a){return e(W,a)});return u("regexp",[b,a])})}function h(){y();return c("Unterminated multiline comment",function(){var a=w("*/",!0),b=z.text.substring(z.pos,a),c=u("comment2",b,!0);z.pos=a+2;z.line+=b.split("\n").length-1;z.newline_before=0<=b.indexOf("\n");return c})}
function i(){y();var a=w("\n"),b;-1==a?(b=z.text.substr(z.pos),z.pos=z.text.length):(b=z.text.substring(z.pos,a),z.pos=a);return u("comment1",b,!0)}function j(a){for(var b=0;0<a;--a){var c=parseInt(y(!0),16);isNaN(c)&&n("Invalid hex-character pattern in string");b=b<<4|c}return b}function l(){var a=y(!0);switch(a){case "n":return"\n";case "r":return"\r";case "t":return"\t";case "b":return"\b";case "v":return"\x0B";case "f":return"\f";case "0":return"\ufffd";case "x":return String.fromCharCode(j(2));
case "u":return String.fromCharCode(j(4));case "\n":return"";default:return a}}function m(a){var b=!1,c=!1,d=!1,e="."==a,f=p(function(f,g){if("x"==f||"X"==f)return d?!1:d=!0;if(!d&&("E"==f||"e"==f))return b?!1:b=c=!0;if("-"==f)return c||0==g&&!a?!0:!1;if("+"==f)return c;c=!1;return"."==f?!e&&!d?e=!0:!1:t(f)||v(f)});a&&(f=a+f);var g;g=f;g=D.test(g)?parseInt(g.substr(2),16):P.test(g)?parseInt(g.substr(1),8):L.test(g)?parseFloat(g):void 0;if(!isNaN(g))return u("num",g);n("Invalid syntax: "+f)}function n(a){throw new q(a,
z.tokline,z.tokcol,z.tokpos);}function p(a){for(var b="",c=C(),d=0;c&&a(c,d++);)b+=y(),c=C();return b}function u(a,b,c){z.regex_allowed="operator"==a&&!e(Y,b)||"keyword"==a&&e(F,b)||"punc"==a&&e(Q,b);a={type:a,value:b,line:z.tokline,col:z.tokcol,pos:z.tokpos,nlb:z.newline_before};c||(a.comments_before=z.comments_before,z.comments_before=[]);z.newline_before=!1;return a}function w(a,b){var c=z.text.indexOf(a,z.pos);if(b&&-1==c)throw S;return c}function y(a){var b=z.text.charAt(z.pos++);if(a&&!b)throw S;
"\n"==b?(z.newline_before=!0,++z.line,z.col=0):++z.col;return b}function C(){return z.text.charAt(z.pos)}var z={text:a.replace(/\r\n?|[\n\u2028\u2029]/g,"\n").replace(/^\uFEFF/,""),pos:0,tokpos:0,line:0,tokline:0,col:0,tokcol:0,newline_before:!1,regex_allowed:!1,comments_before:[]};b.context=function(a){a&&(z=a);return z};return b}function q(a,b,c,d){this.message=a;this.line=b;this.col=c;this.pos=d}function r(a){return"$"==a||("_"==a||v(a))||t(a)}function t(a){a=a.charCodeAt(0);return 48<=a&&57>=
a}function v(a){a=a.charCodeAt(0);return 65<=a&&90>=a||97<=a&&122>=a}var J=h("break case catch const continue default delete do else finally for function if in instanceof new return switch throw try typeof var void while with".split(" ")),C=h("abstract boolean byte char class debugger double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile".split(" ")),F=h("return new delete throw else case".split(" ")),
I=h(["false","null","true","undefined"]),E=h("+-*&%=<>!?|~^".split("")),D=/^0x[0-9a-f]+$/i,P=/^0[0-7]+$/,L=/^\d*\.?\d*(?:e[+-]?\d*(?:\d\.?|\.?\d)\d*)?$/i,N=h("in instanceof typeof new void delete ++ -- + - ! ~ & | ^ * / % >> << >>> < > <= >= == === != !== ? = += -= /= *= %= >>= <<= >>>= |= ^= &= && ||".split(" ")),O=h([" ","\n","\r","\t"]),Q=h("[{}(,.;:".split("")),T=h("[]{}(),;:".split("")),W=h(["g","m","s","i","y"]);q.prototype.toString=function(){return this.message+" (line: "+this.line+", col: "+
this.col+", pos: "+this.pos+")"};for(var S={},V=h("typeof void delete -- ++ ! ~ - +".split(" ")),Y=h(["--","++"]),X,ea="+= -= /= *= %= >>= <<= >>>= |= ^= &=".split(" "),R={"=":!0},$=0;$<ea.length;)R[ea[$]]=ea[$].substr(0,ea[$].length-1),$++;X=R;for(var ha,ea=[["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],"< > <= >= in instanceof".split(" "),[">>","<<",">>>"],["+","-"],["*","/","%"]],R={},$=0,ca=1;$<ea.length;++$,++ca)for(var da=ea[$],ba=0;ba<da.length;++ba)R[da[ba]]=ca;ha=R;var fa=h(["for",
"do","while","switch"]),ga=h(["atom","num","string","regexp","name"]);m.prototype.toString=function(){return this.name};var ia=h("name array object string dot sub call regexp".split(" ")),ja=h("if while do for for-in with".split(" "));return{parse:function(a,b,c){function d(a){try{return++x.in_loop,a()}finally{--x.in_loop}}function h(a){var b;b=n(O(!0),0,a);if(A("operator","?")){B();var c=U(!1);K(":");b=G("conditional",b,c,U(!1,a))}c=x.token.value;if(A("operator")&&e(X,c)){if(l(b))return B(),G("assign",
X[c],b,h(a));L("Invalid assignment")}return b}function l(a){if(!b)return!0;switch(a[0]){case "dot":case "sub":case "new":case "call":return!0;case "name":return"this"!=a[1]}}function n(a,b,c){var d=A("operator")?x.token.value:null;d&&"in"==d&&c&&(d=null);var e=null!=d?ha[d]:null;return null!=e&&e>b?(B(),e=n(O(!0),e,c),n(G("binary",d,a,e),b,c)):a}function p(a,b,c){("++"==b||"--"==b)&&!l(c)&&L("Invalid use of "+b+" operator");return G(a,b,c)}function r(a,b){return A("punc",".")?(B(),r(G("dot",a,t()),
b)):A("punc","[")?(B(),r(G("sub",a,i(U,j(K,"]"))),b)):b&&A("punc","(")?(B(),r(G("call",a,v(")")),!0)):b&&A("operator")&&e(Y,x.token.value)?i(j(p,"unary-postfix",x.token.value,a),B):a}function t(){switch(x.token.type){case "name":case "operator":case "keyword":case "atom":return i(x.token.value,B);default:N()}}function v(a,b,c){for(var d=!0,e=[];!A("punc",a);){d?d=!1:K(",");if(b&&A("punc",a))break;A("punc",",")&&c?e.push(["atom","undefined"]):e.push(U(!1))}B();return e}function w(){return G("const",
J())}function C(a){return G("var",J(a))}function J(a){for(var b=[];;){A("name")||N();var c=x.token.value;B();A("operator","=")?(B(),b.push([c,U(!1,a)])):b.push([c]);if(!A("punc",","))break;B()}return b}function I(){K("{");for(var a=[];!A("punc","}");)A("eof")&&N(),a.push(Z());B();return a}function F(a){var b;D()||(b=A("name")?x.token.value:null);null!=b?(B(),f(b,x.labels)||L("Label "+b+" without matching loop or statement")):0==x.in_loop&&L(a+" not inside a loop or switch");E();return G(a,b)}function H(){return G("stat",
i(U,E))}function z(a){return c?function(){var b=x.token,c=a.apply(this,arguments),d=c,e=c[0],b=e instanceof m?e:new m(e,b,x.prev);d[0]=b;return c}:a}function M(){K("(");var a=U();K(")");return a}function G(){return g(arguments)}function E(){A("punc",";")?B():D()||N()}function D(){return!b&&(x.token.nlb||A("eof")||A("punc","}"))}function K(a){return P("punc",a)}function P(a,b){if(A(a,b))return B();var c=x.token;L("Unexpected token "+x.token.type+", expected "+a,c.line,c.col)}function N(a){null==a&&
(a=x.token);L("Unexpected token: "+a.type+" ("+a.value+")",a.line,a.col)}function L(a,b,c,d){var e=x.input.context();throw new q(a,null!=b?b:e.tokline,null!=c?c:e.tokcol,null!=d?d:e.tokpos);}function B(){x.prev=x.token;x.peeked?(x.token=x.peeked,x.peeked=null):x.token=x.input();return x.token}function A(a,b){return x.token.type==a&&(null==b||x.token.value==b)}var x={input:"string"==typeof a?o(a,!0):a,token:null,prev:null,peeked:null,in_function:0,in_loop:0,labels:[]};x.token=B();for(var Z=z(function(){A("operator",
"/")&&(x.peeked=null,x.token=x.input(!0));switch(x.token.type){case "num":case "string":case "regexp":case "operator":case "atom":return H();case "name":var a=x.peeked||(x.peeked=x.input());if("punc"==a.type&&":"==a.value){a=i(x.token.value,B,B);x.labels.push(a);var c=x.token,f=Z();b&&!e(fa,f[0])&&N(c);x.labels.pop();a=G("label",a,f)}else a=H();return a;case "punc":switch(x.token.value){case "{":return G("block",I());case "[":case "(":return H();case ";":return B(),G("block");default:N()}case "keyword":switch(i(x.token.value,
B)){case "break":return F("break");case "continue":return F("continue");case "debugger":return E(),G("debugger");case "do":return a=d(Z),P("keyword","while"),G("do",i(M,E),a);case "for":a:{K("(");a=null;if(!A("punc",";")&&(a=A("keyword","var")?(B(),C(!0)):U(!0,!0),A("operator","in"))){c="var"==a[0]?G("name",a[1][0]):a;B();f=U();K(")");a=G("for-in",a,c,f,d(Z));break a}K(";");c=A("punc",";")?null:U();K(";");f=A("punc",")")?null:U();K(")");a=G("for",a,c,f,d(Z))}return a;case "function":return ta(!0);
case "if":return c=M(),f=Z(),A("keyword","else")&&(B(),a=Z()),G("if",c,f,a);case "return":return 0==x.in_function&&L("'return' outside of function"),G("return",A("punc",";")?(B(),null):D()?null:i(U,E));case "switch":return G("switch",M(),Ka());case "throw":return G("throw",i(U,E));case "try":return a=I(),A("keyword","catch")&&(B(),K("("),A("name")||L("Name expected"),f=x.token.value,B(),K(")"),f=[f,I()]),A("keyword","finally")&&(B(),c=I()),!f&&!c&&L("Missing catch/finally blocks"),G("try",a,f,c);
case "var":return i(C,E);case "const":return i(w,E);case "while":return G("while",M(),d(Z));case "with":return G("with",M(),Z());default:N()}}}),ta=z(function(a){var b=A("name")?i(x.token.value,B):null;a&&!b&&N();K("(");for(var c=G,a=a?"defun":"function",d=!0,e=[];!A("punc",")");)d?d=!1:K(","),A("name")||N(),e.push(x.token.value),B();B();++x.in_function;d=x.in_loop;x.in_loop=0;var f=I();--x.in_function;x.in_loop=d;return c(a,b,e,f)}),Ka=j(d,function(){K("{");for(var a=[],b=null;!A("punc","}");)A("eof")&&
N(),A("keyword","case")?(B(),b=[],a.push([U(),b]),K(":")):A("keyword","default")?(B(),K(":"),b=[],a.push([null,b])):(b||N(),b.push(Z()));B();return a}),O=z(function(a){if(A("operator","new")){B();var a=O(!1),c;A("punc","(")?(B(),c=v(")")):c=[];return r(G("new",a,c),!0)}if(A("operator")&&e(V,x.token.value))return p("unary-prefix",i(x.token.value,B),O(a));if(A("punc")){switch(x.token.value){case "(":return B(),r(i(U,j(K,")")),a);case "[":return B(),r(G("array",v("]",!b,!0)),a);case "{":B();c=r;var d;
d=!0;for(var f=[];!A("punc","}");){d?d=!1:K(",");if(!b&&A("punc","}"))break;var g=x.token.type,h;a:{switch(x.token.type){case "num":case "string":h=i(x.token.value,B);break a}h=t()}"name"!=g||"get"!=h&&"set"!=h||A("punc",":")?(K(":"),f.push([h,U(!1)])):f.push([t(),ta(!1),h])}B();d=G("object",f);return c(d,a)}N()}if(A("keyword","function"))return B(),r(ta(!1),a);if(e(ga,x.token.type))return c="regexp"==x.token.type?G("regexp",x.token.value[0],x.token.value[1]):G(x.token.type,x.token.value),r(i(c,B),
a);N()}),U=z(function(a,b){0==arguments.length&&(a=!0);var c=h(b);return a&&A("punc",",")?(B(),G("seq",c,U(!0,b))):c}),a=G,Q=[];!A("eof");)Q.push(Z());return a("toplevel",Q)},gen_code:function(h,i){function j(a){var b=a[0],c=Y[b];if(!c)throw Error("Can't find generator for \""+b+'"');V.push(a);a=c.apply(b,a.slice(1));V.pop();return a}function m(a){var b=a[0],a=a[1];null!=a&&(b=D([Q(b),"=",E(a,"seq")]));return b}function o(a){return a?0==a.length?"{}":"{"+K+P(function(){return q(a).join(K)})+K+O("}"):
";"}function q(b,d){for(var e=[],g=b.length-1,h=0;h<=g;++h){var i=b[h],m=j(i);";"!=m&&(!R&&h==g&&("while"==i[0]&&c(i[2])||f(i[0],["for","for-in"])&&c(i[4])||"if"==i[0]&&c(i[2])&&!i[3]||"if"==i[0]&&i[3]&&c(i[3])?m=m.replace(/;*\s*$/,";"):m=m.replace(/;+\s*$/,"")),e.push(m))}return d?e:a(e,O)}function r(b,c,d,e){e=e||"function";b&&(e+=" "+Q(b));e+="("+L(a(c,Q))+")";return D([e,o(d)])}function w(a){var b=a.toString(10),c=[b.replace(/^0\./,".")],d;Math.floor(a)===a?(c.push("0x"+a.toString(16).toLowerCase(),
"0"+a.toString(8)),(d=/^(.*?)(0+)$/.exec(a))&&c.push(d[1]+"e"+d[2].length)):(d=/^0?\.(0+)(.*)$/.exec(a))&&c.push(d[2]+"e-"+(d[1].length+d[2].length),b.substr(b.indexOf(".")));return H(c)}function F(a){if("function"==a[0]||"object"==a[0])for(var b=g(V),c=b.pop(),d=b.pop();d;){if("stat"==d[0])return!0;if(("seq"==d[0]||"call"==d[0]||"dot"==d[0]||"sub"==d[0]||"conditional"==d[0])&&d[1]===c||("binary"==d[0]||"assign"==d[0]||"unary-postfix"==d[0])&&d[2]===c)c=d,d=b.pop();else return!1}return!e(ia,a[0])}
function H(a){if(1==a.length)return a[0];if(2==a.length){var b=a[1],a=a[0];return a.length<=b.length?a:b}return H([a[0],H(a.slice(1))])}function E(a){for(var b=j(a),c=1;c<arguments.length;++c){var d=arguments[c];if(d instanceof Function&&d(a)||a[0]==d)return"("+b+")"}return b}function L(a){return a.join(","+X)}function D(a){if(R)return a.join(" ");for(var b=[],c=0;c<a.length;++c){var d=a[c+1];b.push(a[c]);d&&(/[a-z0-9_\x24]$/i.test(a[c].toString())&&/^[a-z0-9_\x24]/i.test(d.toString())||/[\+\-]$/.test(a[c].toString())&&
/^[\+\-]/.test(d.toString()))&&b.push(" ")}return b.join("")}function P(a,b){null==b&&(b=1);S+=b;try{return a.apply(null,g(arguments,1))}finally{S-=b}}function O(a){null==a&&(a="");R&&(a=(1>i.indent_start+S*i.indent_level?"":Array(i.indent_start+S*i.indent_level+1).join(" "))+a);return a}function Q(a){return a.toString()}var T=i,z={indent_start:0,indent_level:4,quote_keys:!1,space_colon:!1,beautify:!1},W={};!0===T&&(T={});for(var G in z)e(z,G)&&(W[G]=T&&e(T,G)?T[G]:z[G]);var i=W,R=!!i.beautify,S=
0,K=R?"\n":"",X=R?" ":"",Y={string:b,num:w,name:Q,toplevel:function(a){return q(a).join(K)},splice:function(b){return e(ja,V[V.length-2][0])?o.apply(this,arguments):a(q(b,!0),function(a,b){return 0<b?O(a):a}).join(K)},block:o,"var":function(b){return"var "+L(a(b,m))+";"},"const":function(b){return"const "+L(a(b,m))+";"},"try":function(a,b,c){a=["try",o(a)];b&&a.push("catch","("+b[0]+")",o(b[1]));c&&a.push("finally",o(c));return D(a)},"throw":function(a){return D(["throw",j(a)])+";"},"new":function(b,
c){c=0<c.length?"("+L(a(c,j))+")":"";return D(["new",E(b,"seq","binary","conditional","assign",function(a){var b=d(),c={};try{b.with_walkers({call:function(){throw c;},"function":function(){return this}},function(){b.walk(a)})}catch(e){if(e===c)return!0;throw e;}})+c])},"switch":function(b,c){var d="("+j(b)+")",e,f=c.length;e=0==f?"{}":"{"+K+a(c,function(a,b){var c=0<a[1].length,d=P(function(){return O(a[0]?D(["case",j(a[0])+":"]):"default:")},0.5)+(c?K+P(function(){return q(a[1]).join(K)}):"");!R&&
c&&b<f-1&&(d+=";");return d}).join(K)+K+O("}");return D(["switch",d,e])},"break":function(a){var b="break";null!=a&&(b+=" "+Q(a));return b+";"},"continue":function(a){var b="continue";null!=a&&(b+=" "+Q(a));return b+";"},conditional:function(a,b,c){return D([E(a,"assign","seq","conditional"),"?",E(b,"seq"),":",E(c,"seq")])},assign:function(a,b,c){a&&!0!==a?a+="=":a="=";return D([j(b),a,E(c,"seq")])},dot:function(a){var b=j(a),c=1;for("num"==a[0]?/\./.test(a[1])||(b+="."):F(a)&&(b="("+b+")");c<arguments.length;)b+=
"."+Q(arguments[c++]);return b},call:function(b,c){var d=j(b);F(b)&&(d="("+d+")");return d+"("+L(a(c,function(a){return E(a,"seq")}))+")"},"function":r,defun:r,"if":function(a,b,c){a="("+j(a)+")";if(c)a:if("do"==b[0])b=j(["block",[b]]);else{for(var d=b;;){var e=d[0];if("if"==e){if(!d[3]){b=j(["block",[b]]);break a}d=d[3]}else if("while"==e||"do"==e)d=d[2];else if("for"==e||"for-in"==e)d=d[4];else break}b=j(b)}else b=j(b);b=["if",a,b];c&&b.push("else",j(c));return D(b)},"for":function(a,b,c,d){var e=
["for"],a=(null!=a?j(a):"").replace(/;*\s*$/,";"+X),b=(null!=b?j(b):"").replace(/;*\s*$/,";"+X),c=(null!=c?j(c):"").replace(/;*\s*$/,""),a=a+b+c;"; ; "==a&&(a=";;");e.push("("+a+")",j(d));return D(e)},"for-in":function(a,b,c,d){return D(["for","("+(a?j(a).replace(/;+$/,""):j(b)),"in",j(c)+")",j(d)])},"while":function(a,b){return D(["while","("+j(a)+")",j(b)])},"do":function(a,b){return D(["do",j(b),"while","("+j(a)+")"])+";"},"return":function(a){var b=["return"];null!=a&&b.push(j(a));return D(b)+
";"},binary:function(a,b,c){var d=j(b),e=j(c);if(f(b[0],["assign","conditional","seq"])||"binary"==b[0]&&ha[a]>ha[b[1]])d="("+d+")";if(f(c[0],["assign","conditional","seq"])||"binary"==c[0]&&ha[a]>=ha[c[1]]&&(c[1]!=a||!f(a,["&&","||","*"])))e="("+e+")";return D([d,a,e])},"unary-prefix":function(a,b){var c=j(b);"num"==b[0]||"unary-prefix"==b[0]&&!e(N,a+b[1])||!F(b)||(c="("+c+")");var d;d=a.charAt(0);d=t(d)||v(d);return a+(d?" ":"")+c},"unary-postfix":function(a,b){var c=j(b);"num"==b[0]||"unary-postfix"==
b[0]&&!e(N,a+b[1])||!F(b)||(c="("+c+")");return c+a},sub:function(a,b){var c=j(a);F(a)&&(c="("+c+")");return c+"["+j(b)+"]"},object:function(c){return 0==c.length?"{}":"{"+K+P(function(){return a(c,function(a){if(3==a.length)return O(r(a[0],a[1][2],a[1][3],a[2]));var c=a[0],a=j(a[1]);i.quote_keys?c=b(c):("number"==typeof c||!R&&+c+""==c)&&0<=parseFloat(c)?c=w(+c):/^[a-z_$][a-z0-9_$]*$/i.test(c)&&"this"!=c&&!e(I,c)&&!e(C,c)&&!e(J,c)||(c=b(c));return O(D(R&&i.space_colon?[c,":",a]:[c+":",a]))}).join(","+
K)})+K+O("}")},regexp:function(a,b){return"/"+a+"/"+b},array:function(b){return 0==b.length?"[]":D(["[",L(a(b,function(a){return!R&&"atom"==a[0]&&"undefined"==a[1]?"":E(a,"seq")})),"]"])},stat:function(a){return j(a).replace(/;*\s*$/,";")},seq:function(){return L(a(g(arguments),j))},label:function(a,b){return D([Q(a),":",j(b)])},"with":function(a,b){return D(["with","("+j(a)+")",j(b)])},atom:function(a){return Q(a)}},V=[];return j(h)},tokenizer:o,ast_walker:d}},i={"+":"add","-":"subtract","*":"multiply",
"/":"divide","%":"modulo","==":"equals","!=":"equals"},m={"-":"negate"};F.add(window,{load:f});return{compile:c,evaluate:d,load:f,getAttribute:g("get"),hasAttribute:g("has")}};this.load=Y.load;o.each(this,function(a,b){a&&a.prototype instanceof o&&(a._name=b)});this.enumerable=!0;return new (X.inject(this))};